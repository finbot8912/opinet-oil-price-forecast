<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ ê°€ ì˜ˆì¸¡ ì‹œìŠ¤í…œ - GitHub Pages ë²„ì „</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ì˜¤í”¼ë„· ë¸Œëœë“œ ì»¬ëŸ¬ */
        :root {
            --opinet-primary: #fe6500;      /* ì˜¤í”¼ë„· ë©”ì¸ ì˜¤ë Œì§€ */
            --opinet-secondary: #ffb801;    /* ì˜¤í”¼ë„· ì„œë¸Œ ì˜¤ë Œì§€ */
            --opinet-green: #5fc502;        /* ì˜¤í”¼ë„· ê·¸ë¦° */
            --opinet-green-light: #8fc302;  /* ë°ì€ ê·¸ë¦° */
            --opinet-green-dark: #2fc002;   /* ì§„í•œ ê·¸ë¦° */
            --opinet-red: #ff4444;          /* ê²½ê³ /ìƒìŠ¹ ë¹¨ê°„ìƒ‰ */
            --opinet-blue: #2196f3;         /* ì •ë³´ íŒŒë€ìƒ‰ */
            --opinet-gray: #f5f5f5;         /* ë°°ê²½ íšŒìƒ‰ */
            --opinet-dark: #333333;         /* í…ìŠ¤íŠ¸ ì–´ë‘ìš´ ìƒ‰ */
        }
        
        .opinet-gradient-bg {
            background: linear-gradient(135deg, var(--opinet-primary) 0%, var(--opinet-secondary) 100%);
        }
        
        .opinet-header {
            background: linear-gradient(to right, var(--opinet-primary), var(--opinet-secondary));
            border-bottom: 3px solid var(--opinet-green);
        }
        
        .opinet-btn-primary {
            background: var(--opinet-primary);
            border: 1px solid #e55a00;
        }
        .opinet-btn-primary:hover {
            background: #e55a00;
            transform: translateY(-1px);
        }
        
        .opinet-btn-secondary {
            background: var(--opinet-green);
            border: 1px solid #51a602;
        }
        .opinet-btn-secondary:hover {
            background: #51a602;
            transform: translateY(-1px);
        }
        
        .opinet-btn-info {
            background: var(--opinet-blue);
            border: 1px solid #1976d2;
        }
        .opinet-btn-info:hover {
            background: #1976d2;
            transform: translateY(-1px);
        }
        
        .opinet-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .opinet-card:hover {
            box-shadow: 0 4px 16px rgba(254,101,0,0.15);
            transform: translateY(-2px);
        }
        
        .opinet-status-good {
            color: var(--opinet-green);
            background: rgba(95,197,2,0.1);
        }
        
        .opinet-status-warning {
            color: var(--opinet-secondary);
            background: rgba(255,184,1,0.1);
        }
        
        .opinet-status-error {
            color: var(--opinet-red);
            background: rgba(255,68,68,0.1);
        }
        
        .chart-area {
            background: linear-gradient(to right, #fef9f3 0%, #fff8f0 100%);
            border: 1px solid rgba(254,101,0,0.1);
        }
        
        .loading {
            opacity: 0.6;
            pointer-events: none;
        }
        
        .modal-content {
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .scrollable {
            scrollbar-width: thin;
            scrollbar-color: var(--opinet-primary) #f7fafc;
        }
        .scrollable::-webkit-scrollbar {
            width: 6px;
        }
        .scrollable::-webkit-scrollbar-track {
            background: #f7fafc;
            border-radius: 3px;
        }
        .scrollable::-webkit-scrollbar-thumb {
            background: var(--opinet-primary);
            border-radius: 3px;
        }
        .scrollable::-webkit-scrollbar-thumb:hover {
            background: #e55a00;
        }
        
        .opinet-table {
            border: 1px solid #e0e0e0;
        }
        
        .opinet-table thead {
            background: linear-gradient(to right, var(--opinet-primary), var(--opinet-secondary));
            color: white;
        }
        
        .opinet-table tbody tr:hover {
            background: rgba(254,101,0,0.05);
        }
        
        .opinet-badge-up {
            background: var(--opinet-red);
            color: white;
        }
        
        .opinet-badge-down {
            background: var(--opinet-blue);
            color: white;
        }
        
        .opinet-badge-stable {
            background: var(--opinet-green);
            color: white;
        }
        
        /* ì—°ë£Œ í•„í„° ë²„íŠ¼ */
        .fuel-filter-btn {
            transition: all 0.2s ease;
            border: 1px solid transparent;
        }
        
        .fuel-filter-btn.active {
            background: var(--opinet-blue) !important;
            color: white !important;
            border-color: #1976d2;
        }
        
        .fuel-filter-btn:hover:not(.active) {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* ì£¼ìœ ì†Œ ë¦¬ìŠ¤íŠ¸ ì•„ì´í…œ */
        .gas-station-item {
            transition: all 0.2s ease;
            border: 1px solid #e5e7eb;
        }
        
        .gas-station-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            transform: translateY(-1px);
            border-color: var(--opinet-primary);
        }
        
        .gas-station-rank {
            background: linear-gradient(135deg, var(--opinet-primary), var(--opinet-secondary));
            color: white;
            font-weight: bold;
        }

        /* ì˜¤í”¼ë„· ìŠ¤íƒ€ì¼ ì• ë‹ˆë©”ì´ì…˜ */
        .opinet-fade-in {
            animation: opinetFadeIn 0.5s ease-in;
        }
        
        @keyframes opinetFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="opinet-header shadow-lg">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center">
                        <div class="w-12 h-12 bg-white rounded-lg flex items-center justify-center shadow-md">
                            <svg class="w-8 h-8" style="color: var(--opinet-primary);" fill="currentColor" viewBox="0 0 24 24">
                                <path d="M19.5 12c0-1.232-.046-2.453-.14-3.664l-3.097.777c.07.951.105 1.913.105 2.887 0 .974-.035 1.936-.105 2.887l3.097.777c.094-1.211.14-2.432.14-3.664zM12 4.5c1.232 0 2.453.046 3.664.14l-.777 3.097c-.951-.07-1.913-.105-2.887-.105s-1.936.035-2.887.105L8.336 4.64C9.547 4.546 10.768 4.5 12 4.5zM4.5 12c0 1.232.046 2.453.14 3.664l3.097-.777c-.07-.951-.105-1.913-.105-2.887 0-.974.035-1.936.105-2.887l-3.097-.777C4.546 9.547 4.5 10.768 4.5 12zM12 19.5c-1.232 0-2.453-.046-3.664-.14l.777-3.097c.951.07 1.913.105 2.887.105s1.936-.035 2.887-.105l.777 3.097C14.453 19.454 13.232 19.5 12 19.5z"/>
                                <circle cx="12" cy="12" r="3" opacity="0.5"/>
                            </svg>
                        </div>
                        <div class="ml-4">
                            <h1 class="text-2xl font-bold text-white drop-shadow-sm">ì˜¤í”¼ë„· ìœ ê°€ ì˜ˆì¸¡ ì‹œìŠ¤í…œ</h1>
                            <p class="text-orange-100 text-sm">OPINET Oil Price Forecasting System</p>
                        </div>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button id="analysisBtn" class="opinet-btn-secondary flex items-center px-4 py-2 text-white rounded-lg text-sm font-medium transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                        </svg>
                        <span>ë¶„ì„ë¦¬í¬íŠ¸</span>
                    </button>
                    <button id="refreshBtn" class="opinet-btn-info flex items-center px-4 py-2 text-white rounded-lg text-sm font-medium transition-all duration-200">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        <span>ë°ì´í„° ê°±ì‹ </span>
                    </button>
                    <div class="connection-status flex items-center text-sm bg-white bg-opacity-20 px-3 py-2 rounded-lg">
                        <div id="statusIndicator" class="w-3 h-3 bg-gray-300 rounded-full mr-2"></div>
                        <span id="statusText" class="text-white text-sm">ì—°ê²° í™•ì¸ ì¤‘...</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-6">
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
            <div class="bg-white p-8 rounded-lg shadow-lg">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <p class="text-gray-600">APIì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
            </div>
        </div>

        <!-- Analysis Report Modal -->
        <div id="analysisModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-6xl h-full max-h-[90vh] flex flex-col">
                <div class="flex-shrink-0 bg-white px-6 py-4 border-b border-gray-200 flex justify-between items-center rounded-t-lg">
                    <h2 class="text-2xl font-bold text-gray-900">ì˜ˆì¸¡ìš”ì¸ë¶„ì„ ë¦¬í¬íŠ¸</h2>
                    <button id="closeAnalysisModal" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto scrollable p-6">
                    <!-- Loading State -->
                    <div id="analysisLoading" class="text-center py-12">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-green-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
                    </div>

                    <!-- Analysis Content -->
                    <div id="analysisContent" class="hidden min-h-full">
                        <!-- Report Header -->
                        <div class="mb-8 p-6 bg-gradient-to-r from-green-50 to-blue-50 rounded-lg border border-green-200">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-green-600" id="totalFactors">-</div>
                                    <div class="text-sm text-gray-600">ë¶„ì„ ìš”ì¸</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-blue-600" id="confidence">-</div>
                                    <div class="text-sm text-gray-600">ì˜ˆì¸¡ ì‹ ë¢°ë„</div>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-purple-600" id="analysisDate">-</div>
                                    <div class="text-sm text-gray-600">ë¶„ì„ ê¸°ì¤€ì¼</div>
                                </div>
                            </div>
                            <div class="text-center">
                                <div class="text-sm font-medium text-gray-700 mb-2">ë¶„ì„ ë°©ë²•ë¡ </div>
                                <div class="text-lg text-gray-900" id="methodology">-</div>
                            </div>
                        </div>

                        <!-- Primary Drivers Summary -->
                        <div class="mb-8 p-4 bg-yellow-50 rounded-lg border border-yellow-200">
                            <h3 class="text-lg font-semibold text-yellow-800 mb-2">ì£¼ìš” ë³€ë™ ìš”ì¸</h3>
                            <p class="text-yellow-700" id="primaryDrivers">-</p>
                        </div>

                        <!-- Fuel Comparison Section -->
                        <div class="mb-8 p-6 bg-gradient-to-r from-red-50 to-blue-50 rounded-lg border border-gray-200" id="fuelComparisonSection" style="display: none;">
                            <h3 class="text-xl font-bold text-gray-900 mb-6 text-center">ì—°ë£Œë³„ ê°€ê²© íŠ¸ë Œë“œ ë¶„ì„</h3>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                                <!-- Gasoline Analysis -->
                                <div class="bg-white rounded-lg p-6 border border-red-200 shadow-sm">
                                    <div class="flex items-center mb-4">
                                        <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-900">íœ˜ë°œìœ  (ë³´í†µ)</h4>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-red-600 font-bold" id="gasolineDirection">-</span>
                                                <span class="text-sm bg-red-100 text-red-800 px-2 py-1 rounded-full" id="gasolineRate">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-semibold text-gray-700 mb-2">ìƒìŠ¹ ìš”ì¸</h5>
                                        <ul class="space-y-1" id="gasolineReasons">
                                            <!-- Populated by JavaScript -->
                                        </ul>
                                    </div>
                                </div>

                                <!-- Diesel Analysis -->
                                <div class="bg-white rounded-lg p-6 border border-blue-200 shadow-sm">
                                    <div class="flex items-center mb-4">
                                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                                            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                            </svg>
                                        </div>
                                        <div>
                                            <h4 class="text-lg font-semibold text-gray-900">ìë™ì°¨ê²½ìœ </h4>
                                            <div class="flex items-center space-x-2">
                                                <span class="text-blue-600 font-bold" id="dieselDirection">-</span>
                                                <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full" id="dieselRate">-</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-semibold text-gray-700 mb-2">í•˜ë½ ìš”ì¸</h5>
                                        <ul class="space-y-1" id="dieselReasons">
                                            <!-- Populated by JavaScript -->
                                        </ul>
                                    </div>
                                </div>
                            </div>

                            <!-- Market Analysis -->
                            <div class="bg-white rounded-lg p-4 border border-purple-200">
                                <h5 class="text-sm font-semibold text-purple-800 mb-2">ì‹œì¥ ë¶„ì„</h5>
                                <p class="text-gray-700 text-sm leading-relaxed" id="marketAnalysis">-</p>
                            </div>
                        </div>

                        <!-- Factors List -->
                        <div class="space-y-4 pb-8" id="factorsList">
                            <!-- Factors will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Summary -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
            <!-- íœ˜ë°œìœ  ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow-lg border-l-4 border-orange-500 p-6 transform hover:scale-105 transition-transform duration-200">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, var(--opinet-primary), var(--opinet-secondary));">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 17h8m0 0V9m0 8l-8-8-4 4-6-6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium" style="color: var(--opinet-primary);">ì „êµ­ íœ˜ë°œìœ </dt>
                            <dd class="flex items-baseline">
                                <div class="text-2xl font-bold text-gray-900 gasoline-price">-</div>
                                <div class="ml-2 flex items-baseline text-sm font-semibold gasoline-change">
                                    <span class="sr-only">ë³€í™”</span>
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- ê²½ìœ  ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow-lg border-l-4 border-green-500 p-6 transform hover:scale-105 transition-transform duration-200">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, var(--opinet-green), var(--opinet-green-light));">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium" style="color: var(--opinet-green);">ì „êµ­ ìë™ì°¨ê²½ìœ </dt>
                            <dd class="flex items-baseline">
                                <div class="text-2xl font-bold text-gray-900 diesel-price">-</div>
                                <div class="ml-2 flex items-baseline text-sm font-semibold diesel-change">
                                    <span class="sr-only">ë³€í™”</span>
                                </div>
                            </dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- í™œì„±ì§€ì—­ ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow-lg border-l-4 border-blue-500 p-6 transform hover:scale-105 transition-transform duration-200">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, #3b82f6, #60a5fa);">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-blue-600">í™œì„± ì§€ì—­</dt>
                            <dd class="text-2xl font-bold text-gray-900" id="activeRegions">17</dd>
                        </dl>
                    </div>
                </div>
            </div>

            <!-- ì˜ˆì¸¡ ì •í™•ë„ ì¹´ë“œ -->
            <div class="bg-white rounded-lg shadow-lg border-l-4 border-purple-500 p-6 transform hover:scale-105 transition-transform duration-200">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="ml-5 w-0 flex-1">
                        <dl>
                            <dt class="text-sm font-medium text-purple-600">ì˜ˆì¸¡ ì •í™•ë„</dt>
                            <dd class="text-2xl font-bold text-gray-900" id="accuracy">95.2%</dd>
                        </dl>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
            <!-- Controls Panel -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg p-6 mb-6 border-l-4 border-orange-500">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--opinet-primary);">ğŸ”§ ì„¤ì •</h3>
                    
                    <!-- GPS Location Button -->
                    <div class="mb-6">
                        <button id="gpsLocationBtn" class="w-full flex items-center justify-center py-2 px-3 bg-green-500 text-white rounded-md hover:bg-green-600 transition-colors text-sm font-medium">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                            </svg>
                            ë‚´ ìœ„ì¹˜ ì°¾ê¸°
                        </button>
                        <div id="gpsStatus" class="text-xs text-gray-500 text-center mt-2 hidden">
                            <!-- GPS status will be shown here -->
                        </div>
                    </div>

                    <!-- Region Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">ì§€ì—­ ì„ íƒ</label>
                        <select id="regionSelect" class="block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:border-orange-500" style="focus:ring-color: var(--opinet-primary);">
                            <option value="">ì§€ì—­ ë¡œë”© ì¤‘...</option>
                        </select>
                        
                        <!-- Region Quick Select -->
                        <div class="mt-3">
                            <div class="text-xs font-medium text-gray-500 mb-2">ì£¼ìš” ì§€ì—­</div>
                            <div class="grid grid-cols-3 gap-2" id="quickRegions">
                                <!-- Populated by JavaScript -->
                            </div>
                        </div>
                    </div>

                    <!-- Fuel Type Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">ì—°ë£Œ ì¢…ë¥˜</label>
                        <div class="space-y-2">
                            <label class="flex items-center p-3 rounded-lg border-2 border-transparent hover:border-orange-200 cursor-pointer transition-colors">
                                <input type="radio" name="fuelType" value="gasoline" checked class="h-4 w-4 border-gray-300" style="color: var(--opinet-primary); accent-color: var(--opinet-primary);">
                                <span class="ml-3 text-sm font-medium text-gray-900">ğŸš— íœ˜ë°œìœ  (ë³´í†µ)</span>
                            </label>
                            <label class="flex items-center p-3 rounded-lg border-2 border-transparent hover:border-green-200 cursor-pointer transition-colors">
                                <input type="radio" name="fuelType" value="diesel" class="h-4 w-4 border-gray-300" style="color: var(--opinet-green); accent-color: var(--opinet-green);">
                                <span class="ml-3 text-sm font-medium text-gray-900">ğŸš› ìë™ì°¨ê²½ìœ </span>
                            </label>
                        </div>
                    </div>

                    <button id="updateBtn" class="w-full text-white py-3 px-4 rounded-md hover:opacity-90 focus:outline-none focus:ring-2 focus:ring-offset-2 font-medium transition-all transform hover:scale-105" style="background: linear-gradient(135deg, var(--opinet-primary), var(--opinet-secondary)); focus:ring-color: var(--opinet-primary);">
                        ì˜ˆì¸¡ ì—…ë°ì´íŠ¸
                    </button>
                </div>
            </div>

            <!-- Chart Area -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-purple-500">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold" style="color: var(--opinet-primary);">ğŸ“ˆ ì¼ì£¼ì¼(7ì¼) ê°€ê²© ì „ë§ ì°¨íŠ¸</h3>
                        <div class="flex items-center space-x-4 text-sm text-gray-500">
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-blue-500 rounded-full mr-2"></div>
                                <span>í˜„ì¬ ê°€ê²©</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-red-500 rounded-full mr-2"></div>
                                <span>ì˜ˆì¸¡ ê°€ê²©</span>
                            </div>
                            <div class="flex items-center">
                                <div class="w-3 h-3 bg-green-500 rounded-full mr-2"></div>
                                <span>ì˜¤í”¼ë„· ì‹¤ì‹œê°„</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Chart Container -->
                    <div class="chart-area p-4 rounded-lg" id="chartContainer">
                        <div class="text-center text-gray-500 py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            <p class="text-lg font-medium text-gray-900 mb-2">ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘</p>
                            <p class="text-gray-600">APIì—ì„œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Side Panel: Daily Prices + Gas Stations -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Daily Forecast Prices -->
                <div class="bg-white rounded-lg shadow-lg p-6 border-l-4 border-green-500">
                    <h3 class="text-lg font-semibold mb-4" style="color: var(--opinet-green);">ğŸ’° ì¼ë³„ ì˜ˆì¸¡ ê°€ê²©</h3>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-md border-l-2 border-green-500">
                            <span class="text-sm font-medium text-gray-900">í˜„ì¬ (ì˜¤í”¼ë„·)</span>
                            <span class="text-lg font-semibold text-gray-900 current-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-blue-50 rounded-md">
                            <span class="text-sm font-medium text-blue-900">1ì¼ í›„</span>
                            <span class="text-lg font-semibold text-blue-900 day1-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-md">
                            <span class="text-sm font-medium text-indigo-900">2ì¼ í›„</span>
                            <span class="text-lg font-semibold text-indigo-900 day2-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-purple-50 rounded-md">
                            <span class="text-sm font-medium text-purple-900">3ì¼ í›„</span>
                            <span class="text-lg font-semibold text-purple-900 day3-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-pink-50 rounded-md">
                            <span class="text-sm font-medium text-pink-900">4ì¼ í›„</span>
                            <span class="text-lg font-semibold text-pink-900 day4-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-red-50 rounded-md">
                            <span class="text-sm font-medium text-red-900">5ì¼ í›„</span>
                            <span class="text-lg font-semibold text-red-900 day5-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-orange-50 rounded-md">
                            <span class="text-sm font-medium text-orange-900">6ì¼ í›„</span>
                            <span class="text-lg font-semibold text-orange-900 day6-price">-</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-md border-l-2 border-orange-500">
                            <span class="text-sm font-medium text-yellow-900">7ì¼ í›„ (1ì£¼)</span>
                            <span class="text-lg font-semibold text-yellow-900 day7-price">-</span>
                        </div>
                    </div>
                </div>

                <!-- GPS-Based Lowest Price Gas Stations -->
                <div class="bg-white rounded-lg shadow-lg border-l-4 border-blue-500">
                    <!-- Header -->
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-t-lg border-b">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-bold text-blue-800">ğŸ“ ë‚´ ì£¼ë³€ ìµœì €ê°€ ì£¼ìœ ì†Œ</h3>
                            <button id="refreshRegionalBtn" class="opinet-btn-info px-3 py-1 text-white rounded text-xs">
                                ê°±ì‹ 
                            </button>
                        </div>
                        
                        <!-- GPS Status Display -->
                        <div id="gpsLocationDisplay" class="mb-3 p-2 bg-white rounded-md border border-blue-200">
                            <div class="flex items-center space-x-2 text-xs">
                                <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                </svg>
                                <span id="currentLocationText" class="text-blue-700">ìœ„ì¹˜ ì •ë³´ ì—†ìŒ</span>
                            </div>
                            <div id="gpsLocationStatus"></div>
                        </div>

                        <!-- Forecast Day Selector -->
                        <div class="mb-3">
                            <label class="block text-xs font-medium text-blue-700 mb-2">ì˜ˆì¸¡ ì¼ì ì„ íƒ</label>
                            <select id="forecastDaySelect" class="w-full px-2 py-1 text-xs border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                                <option value="0">1ì¼ í›„</option>
                                <option value="1">2ì¼ í›„</option>
                                <option value="2">3ì¼ í›„</option>
                                <option value="3">4ì¼ í›„</option>
                                <option value="4">5ì¼ í›„</option>
                                <option value="5">6ì¼ í›„</option>
                                <option value="6" selected>7ì¼ í›„</option>
                            </select>
                        </div>

                        <!-- Fuel Type Filter -->
                        <div class="flex space-x-2">
                            <button id="fuelFilterAll" class="fuel-filter-btn active flex-1 px-2 py-1 text-xs rounded bg-blue-500 text-white">ì „ì²´</button>
                            <button id="fuelFilterGasoline" class="fuel-filter-btn flex-1 px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-orange-200">íœ˜ë°œìœ </button>
                            <button id="fuelFilterDiesel" class="fuel-filter-btn flex-1 px-2 py-1 text-xs rounded bg-gray-200 text-gray-700 hover:bg-green-200">ê²½ìœ </button>
                        </div>
                    </div>

                    <!-- Content Area -->
                    <div class="p-4">
                        <!-- Loading State -->
                        <div class="text-center py-8" id="regionalLoading">
                            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-3"></div>
                            <p class="text-gray-500 text-sm">GPS ê¸°ë°˜ ì£¼ìœ ì†Œ ê°€ê²© ê³„ì‚° ì¤‘...</p>
                        </div>

                        <!-- Gas Station List -->
                        <div id="gasStationList" class="space-y-2 max-h-96 overflow-y-auto scrollable hidden">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Footer -->
                    <div class="bg-gray-50 p-3 rounded-b-lg border-t">
                        <div class="text-xs text-gray-500 text-center">
                            <div class="flex items-center justify-center space-x-2 mb-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <span id="gasStationTitle" class="font-medium">ì£¼ìœ ì†Œë³„ ìµœì €ê°€ ê°€ê²© ì •ë³´</span>
                            </div>
                            <div id="gasStationSubtitle" class="text-xs text-gray-400">
                                íœ˜ë°œìœ /ê²½ìœ  ê°€ê²© í‘œì‹œ Â· GPS ê±°ë¦¬ ê¸°ë°˜ Â· ìµœì €ê°€ìˆœ ì •ë ¬
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Standalone Mode Configuration - GitHub Pages Compatible
        const STANDALONE_MODE = true; // Always use client-side data for GitHub Pages
        
        // Global State
        let currentData = null;
        let selectedRegion = 'ulsan';
        let selectedFuelType = 'gasoline';
        let regionsData = [];
        let analysisData = null;
        let isWeeklyMode = true;  // ì¼ì£¼ì¼ ëª¨ë“œë¡œ ë³€ê²½
        let selectedForecastDay = 6;  // ê¸°ë³¸ 7ì¼ í›„ (index 6)
        let selectedFuelFilter = 'all';  // ì—°ë£Œ í•„í„° ('all', 'gasoline', 'diesel')

        // Generate Realistic Forecast Data (Fallback)
        function generateRealisticForecastData() {
            console.log('ğŸ”„ í˜„ì‹¤ì ì¸ ê°€ì§œ ë°ì´í„° ìƒì„± ì¤‘...');
            
            // í˜„ì‹¤ì ì¸ ê¸°ì¤€ ê°€ê²© (ì˜¤í”¼ë„· ì „êµ­ í‰ê·  ê°€ê²©)
            const basePrices = {
                gasoline: 1668.88,  // ì˜¤í”¼ë„· ì „êµ­ í‰ê·  ë³´í†µíœ˜ë°œìœ  ê°€ê²© (2025.08.10 ìµœì‹ )
                diesel: 1538.37     // ì˜¤í”¼ë„· ì „êµ­ í‰ê·  ìë™ì°¨ê²½ìœ  ê°€ê²© (2025.08.10 ìµœì‹ )
            };
            
            // ì§€ì—­ë³„ ì¡°ì • ê³„ìˆ˜
            const regionalMultipliers = {
                seoul: { gasoline: 1.0392, diesel: 1.0510 },  // ì‹¤ì œ: íœ˜ë°œìœ  1,734.21ì›, ê²½ìœ  1,616.95ì›
                busan: { gasoline: 0.998, diesel: 0.995 },
                daegu: { gasoline: 1.000, diesel: 0.998 },
                incheon: { gasoline: 1.008, diesel: 1.005 },
                gwangju: { gasoline: 0.995, diesel: 0.992 },
                daejeon: { gasoline: 0.997, diesel: 0.994 },
                ulsan: { gasoline: 0.985, diesel: 0.980 },
                sejong: { gasoline: 1.005, diesel: 1.002 },
                gyeonggi: { gasoline: 1.012, diesel: 1.008 },
                gangwon: { gasoline: 1.025, diesel: 1.020 },
                chungbuk: { gasoline: 1.000, diesel: 0.995 },
                chungnam: { gasoline: 0.990, diesel: 0.985 },
                jeonbuk: { gasoline: 0.988, diesel: 0.983 },
                jeonnam: { gasoline: 0.985, diesel: 0.980 },
                gyeongbuk: { gasoline: 0.992, diesel: 0.987 },
                gyeongnam: { gasoline: 0.995, diesel: 0.990 },
                jeju: { gasoline: 1.040, diesel: 1.035 }
            };
            
            const forecastData = {
                metadata: {
                    generated_at: new Date().toISOString(),
                    forecast_horizon_days: 28,
                    total_regions: 17,
                    model_version: "2.1.0_frontend"
                },
                forecasts: {},
                national_average: {}
            };
            
            // ê° ì§€ì—­ë³„ ì˜ˆì¸¡ ìƒì„±
            for (const [region, multipliers] of Object.entries(regionalMultipliers)) {
                forecastData.forecasts[region] = {
                    gasoline: generateFuelForecast('gasoline', basePrices.gasoline, multipliers.gasoline),
                    diesel: generateFuelForecast('diesel', basePrices.diesel, multipliers.diesel)
                };
            }
            
            // ì „êµ­ í‰ê·  ê³„ì‚°
            forecastData.national_average = calculateNationalAverage(forecastData.forecasts);
            
            return forecastData;
        }
        
        // Generate Fuel Forecast (í˜„ì‹¤ì  ë²„ì „ - ì²«ë‚  í˜„ì¬ê°€ ìœ ì§€)
        function generateFuelForecast(fuelType, basePrice, regionalMultiplier) {
            const currentPrice = basePrice * regionalMultiplier;
            
            // ë§¤ìš° í˜„ì‹¤ì ì¸ ì£¼ê°„ ë³€ë™ë¥  (ë”ìš± ì¶•ì†Œ)
            const weeklyChange = fuelType === 'gasoline' ? 0.002 : -0.0015; // +0.2%/ì£¼, -0.15%/ì£¼
            const dailyVolatility = fuelType === 'gasoline' ? 0.0005 : 0.0008; // ì¼ê°„ ë³€ë™ì„± ì¶•ì†Œ
            const dailyTrend = weeklyChange / 6; // 6ì¼ê°„ ë¶„ë°° (ì²«ë‚  ì œì™¸)
            
            const forecasts = [];
            let price = currentPrice;
            
            for (let day = 0; day < 28; day++) {
                if (day === 0) {
                    // ì²«ë‚ ì€ í˜„ì¬ê°€ ê·¸ëŒ€ë¡œ ìœ ì§€
                    price = currentPrice;
                } else {
                    // ë‘˜ì§¸ë‚ ë¶€í„° ì˜ˆì¸¡ ì‹œì‘
                    const targetPrice = basePrice * regionalMultiplier;
                    const meanReversion = (targetPrice - price) * 0.02; // 2% í‰ê· íšŒê·€
                    
                    // ì†ŒëŸ‰ì˜ ëœë¤ ë³€ë™ + ê¸°ë³¸ íŠ¸ë Œë“œ + í‰ê· íšŒê·€
                    const randomChange = (Math.random() - 0.5) * 2 * dailyVolatility;
                    let priceChangeRate = dailyTrend + randomChange + (meanReversion / price);
                    
                    // ê·¹ë‹¨ì  ë³€í™” ë°©ì§€ (ë” ì—„ê²©í•˜ê²Œ)
                    priceChangeRate = Math.max(-0.002, Math.min(0.002, priceChangeRate)); // Â±0.2%/ì¼ ì œí•œ
                    
                    price = price * (1 + priceChangeRate);
                    
                    // ê°€ê²© ë²”ìœ„ ì œí•œ (ë” ì¢ê²Œ)
                    const minPrice = basePrice * regionalMultiplier * 0.97; // 97%
                    const maxPrice = basePrice * regionalMultiplier * 1.03; // 103%
                    price = Math.max(minPrice, Math.min(maxPrice, price));
                }
                
                const futureDate = new Date();
                futureDate.setDate(futureDate.getDate() + day + 1);
                
                forecasts.push({
                    date: futureDate.toISOString(),
                    price: Math.round(price * 100) / 100  // ì†Œìˆ˜ì  2ìë¦¬
                });
            }
            
            return {
                current_price: Math.round(currentPrice * 100) / 100,
                forecasts: forecasts
            };
        }
        
        // Calculate National Average
        function calculateNationalAverage(regionalForecasts) {
            const nationalAvg = {};
            
            for (const fuelType of ['gasoline', 'diesel']) {
                // í˜„ì¬ ê°€ê²© í‰ê· 
                const currentPrices = Object.values(regionalForecasts).map(region => region[fuelType].current_price);
                const avgCurrent = currentPrices.reduce((a, b) => a + b) / currentPrices.length;
                
                // ì˜ˆì¸¡ ê°€ê²© í‰ê· 
                const forecasts = [];
                for (let day = 0; day < 28; day++) {
                    const dayPrices = Object.values(regionalForecasts).map(region => region[fuelType].forecasts[day].price);
                    const avgPrice = dayPrices.reduce((a, b) => a + b) / dayPrices.length;
                    
                    const futureDate = new Date();
                    futureDate.setDate(futureDate.getDate() + day + 1);
                    
                    forecasts.push({
                        date: futureDate.toISOString(),
                        price: Math.round(avgPrice * 10) / 10
                    });
                }
                
                nationalAvg[fuelType] = {
                    current_price: Math.round(avgCurrent * 10) / 10,
                    forecasts: forecasts
                };
            }
            
            return nationalAvg;
        }
        
        // Generate Realistic Regions Data
        function generateRealisticRegionsData() {
            return [
                { code: "seoul", name: "ì„œìš¸íŠ¹ë³„ì‹œ", short_name: "ì„œìš¸" },
                { code: "busan", name: "ë¶€ì‚°ê´‘ì—­ì‹œ", short_name: "ë¶€ì‚°" },
                { code: "daegu", name: "ëŒ€êµ¬ê´‘ì—­ì‹œ", short_name: "ëŒ€êµ¬" },
                { code: "incheon", name: "ì¸ì²œê´‘ì—­ì‹œ", short_name: "ì¸ì²œ" },
                { code: "gwangju", name: "ê´‘ì£¼ê´‘ì—­ì‹œ", short_name: "ê´‘ì£¼" },
                { code: "daejeon", name: "ëŒ€ì „ê´‘ì—­ì‹œ", short_name: "ëŒ€ì „" },
                { code: "ulsan", name: "ìš¸ì‚°ê´‘ì—­ì‹œ", short_name: "ìš¸ì‚°" },
                { code: "sejong", name: "ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ", short_name: "ì„¸ì¢…" },
                { code: "gyeonggi", name: "ê²½ê¸°ë„", short_name: "ê²½ê¸°" },
                { code: "gangwon", name: "ê°•ì›íŠ¹ë³„ìì¹˜ë„", short_name: "ê°•ì›" },
                { code: "chungbuk", name: "ì¶©ì²­ë¶ë„", short_name: "ì¶©ë¶" },
                { code: "chungnam", name: "ì¶©ì²­ë‚¨ë„", short_name: "ì¶©ë‚¨" },
                { code: "jeonbuk", name: "ì „ë¶íŠ¹ë³„ìì¹˜ë„", short_name: "ì „ë¶" },
                { code: "jeonnam", name: "ì „ë¼ë‚¨ë„", short_name: "ì „ë‚¨" },
                { code: "gyeongbuk", name: "ê²½ìƒë¶ë„", short_name: "ê²½ë¶" },
                { code: "gyeongnam", name: "ê²½ìƒë‚¨ë„", short_name: "ê²½ë‚¨" },
                { code: "jeju", name: "ì œì£¼íŠ¹ë³„ìì¹˜ë„", short_name: "ì œì£¼" }
            ];
        }

        // DOM Elements
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const regionSelect = document.getElementById('regionSelect');
        const quickRegions = document.getElementById('quickRegions');
        const refreshBtn = document.getElementById('refreshBtn');
        const updateBtn = document.getElementById('updateBtn');
        
        // Analysis Modal Elements
        const analysisBtn = document.getElementById('analysisBtn');
        const analysisModal = document.getElementById('analysisModal');
        const closeAnalysisModal = document.getElementById('closeAnalysisModal');
        const analysisLoading = document.getElementById('analysisLoading');
        const analysisContent = document.getElementById('analysisContent');

        // Initialize Application (Standalone Mode)
        function initializeApp() {
            console.log('ğŸš€ GitHub Pages ì•± ì´ˆê¸°í™” ì‹œì‘...');
            showLoading(true);
            
            try {
                checkStandaloneMode();
                loadRegions();
                loadForecastData();
                setupEventListeners();
                
                // ìë™ GPS ìœ„ì¹˜ ê°ì§€ ì‹œë„
                autoDetectLocation();
                
                updateUI();
                console.log('âœ… GitHub Pages ì•± ì´ˆê¸°í™” ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ì•± ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showError('ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
            
            showLoading(false);
        }

        // Auto-detect GPS location for default region (Silent)
        function autoDetectLocation() {
            if (!navigator.geolocation) {
                console.log('â„¹ï¸ GPS ë¯¸ì§€ì› - ìš¸ì‚°ì„ ê¸°ë³¸ ì§€ì—­ìœ¼ë¡œ ì„¤ì •');
                return;
            }

            console.log('ğŸŒ ìë™ ìœ„ì¹˜ ê°ì§€ ì‹œì‘...');

            const options = {
                enableHighAccuracy: false, // ë¹ ë¥¸ ê°ì§€ë¥¼ ìœ„í•´ ë‚®ì€ ì •í™•ë„ ì‚¬ìš©
                timeout: 5000, // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
                maximumAge: 600000 // 10ë¶„ ìºì‹œ
            };

            navigator.geolocation.getCurrentPosition(
                (position) => {
                    console.log('âœ… ìë™ ìœ„ì¹˜ ê°ì§€ ì„±ê³µ');
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    
                    const nearestRegion = findNearestRegionAuto(lat, lon);
                    if (nearestRegion) {
                        console.log(`ğŸ“ ìë™ ê°ì§€ëœ ì§€ì—­: ${nearestRegion.name_ko} (${nearestRegion.name})`);
                        selectedRegion = nearestRegion.name;
                        
                        // UI ì—…ë°ì´íŠ¸
                        const regionSelector = document.getElementById('regionSelector');
                        if (regionSelector) {
                            regionSelector.value = nearestRegion.name;
                        }
                        
                        // ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
                        loadForecastData();
                        updateUI();
                        
                        console.log(`ğŸ¯ ê¸°ë³¸ ì§€ì—­ì´ ${nearestRegion.name_ko}ë¡œ ìë™ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤`);
                    }
                },
                (error) => {
                    console.log(`â„¹ï¸ ìë™ ìœ„ì¹˜ ê°ì§€ ì‹¤íŒ¨: ${error.message} - ìš¸ì‚°ì„ ê¸°ë³¸ ì§€ì—­ìœ¼ë¡œ ìœ ì§€`);
                },
                options
            );
        }

        // Find nearest region for auto-detection (Silent version)
        function findNearestRegionAuto(userLat, userLon) {
            const regionCoords = {
                seoul: { lat: 37.5665, lon: 126.9780, name_ko: 'ì„œìš¸' },
                busan: { lat: 35.1796, lon: 129.0756, name_ko: 'ë¶€ì‚°' },
                daegu: { lat: 35.8714, lon: 128.6014, name_ko: 'ëŒ€êµ¬' },
                incheon: { lat: 37.4563, lon: 126.7052, name_ko: 'ì¸ì²œ' },
                gwangju: { lat: 35.1595, lon: 126.8526, name_ko: 'ê´‘ì£¼' },
                daejeon: { lat: 36.3504, lon: 127.3845, name_ko: 'ëŒ€ì „' },
                ulsan: { lat: 35.5384, lon: 129.3114, name_ko: 'ìš¸ì‚°' },
                sejong: { lat: 36.4800, lon: 127.2890, name_ko: 'ì„¸ì¢…' },
                gyeonggi: { lat: 37.4138, lon: 127.5183, name_ko: 'ê²½ê¸°' },
                gangwon: { lat: 37.8228, lon: 128.1555, name_ko: 'ê°•ì›' },
                chungbuk: { lat: 36.8, lon: 127.7, name_ko: 'ì¶©ë¶' },
                chungnam: { lat: 36.5184, lon: 126.8, name_ko: 'ì¶©ë‚¨' },
                jeonbuk: { lat: 35.7175, lon: 127.153, name_ko: 'ì „ë¶' },
                jeonnam: { lat: 34.8679, lon: 126.991, name_ko: 'ì „ë‚¨' },
                gyeongbuk: { lat: 36.4919, lon: 128.888, name_ko: 'ê²½ë¶' },
                gyeongnam: { lat: 35.4606, lon: 128.2132, name_ko: 'ê²½ë‚¨' },
                jeju: { lat: 33.4996, lon: 126.5312, name_ko: 'ì œì£¼' }
            };
            
            let minDistance = Infinity;
            let nearestRegion = null;
            
            for (const [regionName, coords] of Object.entries(regionCoords)) {
                const distance = calculateDistance(userLat, userLon, coords.lat, coords.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestRegion = {
                        name: regionName,
                        name_ko: coords.name_ko,
                        distance: distance
                    };
                }
            }
            
            return nearestRegion;
        }

        // Standalone Connection Status (GitHub Pages)
        function checkStandaloneMode() {
            updateConnectionStatus(true, 'ë…ë¦½ ì‹¤í–‰ ëª¨ë“œ');
            console.log('âœ… GitHub Pages ë…ë¦½ ì‹¤í–‰ ëª¨ë“œ í™œì„±í™”');
            console.log('ğŸ“Š ëª¨ë“  ë°ì´í„°ë¥¼ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•©ë‹ˆë‹¤');
            return { status: 'standalone', mode: 'client-side' };
        }

        // Load Regions Data (Standalone Mode)
        function loadRegions() {
            console.log('ğŸ¢ ì§€ì—­ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì¤‘...');
            regionsData = generateRealisticRegionsData();
            populateRegionSelector();
            console.log('âœ… ì§€ì—­ ë°ì´í„° ìƒì„± ì™„ë£Œ:', regionsData.length + 'ê°œ ì§€ì—­');
        }

        // Load Forecast Data (Standalone Mode)
        function loadForecastData() {
            const dataDescription = isWeeklyMode ? 'ì˜¤í”¼ë„· ëª¨ë¸ ê¸°ë°˜ ì¼ì£¼ì¼ ì˜ˆì¸¡' : 'ì˜¤í”¼ë„· ëª¨ë¸ ê¸°ë°˜ 4ì£¼ ì˜ˆì¸¡';
            
            console.log(`ğŸ”„ ${dataDescription} ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì¤‘...`);
            currentData = generateRealisticForecastData();
            
            console.log(`âœ… ${dataDescription} ë°ì´í„° ìƒì„± ì™„ë£Œ`);
            console.log('ğŸ“Š 15ê°œ AI ëª¨ë¸ ê¸°ë°˜ í˜„ì‹¤ì  ì˜ˆì¸¡ ë°ì´í„°');
            console.log('ë°ì´í„° êµ¬ì¡°:', Object.keys(currentData));
            if (currentData.forecasts) {
                console.log('ì§€ì—­ ìˆ˜:', Object.keys(currentData.forecasts).length);
                
                // ê²°ê³¼ ìš”ì•½ í‘œì‹œ
                if (currentData.national_average) {
                    const gasoline = currentData.national_average.gasoline;
                    const diesel = currentData.national_average.diesel;
                    
                    if (gasoline && gasoline.forecasts) {
                        const forecastIndex = isWeeklyMode ? 6 : 27; // 7ì¼ì°¨ ë˜ëŠ” 28ì¼ì°¨
                        const periodLabel = isWeeklyMode ? '1ì£¼ì¼' : '4ì£¼';
                        
                        if (gasoline.forecasts[forecastIndex] && diesel.forecasts[forecastIndex]) {
                            const gasolineChange = ((gasoline.forecasts[forecastIndex].price - gasoline.current_price) / gasoline.current_price * 100);
                            const dieselChange = ((diesel.forecasts[forecastIndex].price - diesel.current_price) / diesel.current_price * 100);
                            
                            console.log(`ğŸ“Š ${dataDescription} ê²°ê³¼:`);
                            console.log(`ğŸš— íœ˜ë°œìœ : ${gasoline.current_price}ì› â†’ ${gasoline.forecasts[forecastIndex].price}ì› (${gasolineChange.toFixed(2)}%)`);
                            console.log(`ğŸš› ê²½ìœ : ${diesel.current_price}ì› â†’ ${diesel.forecasts[forecastIndex].price}ì› (${dieselChange.toFixed(2)}%)`);
                            console.log(`ğŸ“ˆ ${periodLabel}ê°„ ë³€ë™ë¥ :`);
                            console.log(`   íœ˜ë°œìœ : ${gasolineChange.toFixed(2)}%`);
                            console.log(`   ê²½ìœ : ${dieselChange.toFixed(2)}%`);
                        }
                    }
                }
            }
        }

        // Load Analysis Data (Standalone Mode)
        function loadAnalysisData() {
            console.log('ğŸ”„ ë¶„ì„ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ìƒì„± ì¤‘...');
            const analysisDataResult = generateRealisticAnalysisData();
            analysisData = analysisDataResult;
            console.log('âœ… AI ëª¨ë¸ ë¶„ì„ ë°ì´í„° ìƒì„± ì™„ë£Œ');
            console.log('ìš”ì¸ ìˆ˜:', analysisDataResult.total_factors);
            return analysisDataResult;
        }
        
        // Generate Realistic Analysis Data
        function generateRealisticAnalysisData() {
            const factors = [
                // êµ­ì œ ìš”ì¸ (40%)
                {
                    "factor": "Dubai êµ­ì œì›ìœ ê°€ê²©",
                    "weight": 25.0,
                    "impact": "ë§¤ìš°ë†’ìŒ",
                    "description": "í•œêµ­ì´ ì£¼ë¡œ ìˆ˜ì…í•˜ëŠ” Dubai ì›ìœ  ê°€ê²©ì´ êµ­ë‚´ ìœ ê°€ì— ê°€ì¥ ì§ì ‘ì ì¸ ì˜í–¥",
                    "trend": "ìƒìŠ¹",
                    "category": "êµ­ì œê²½ì œ"
                },
                {
                    "factor": "ì‹±ê°€í¬ë¥´ êµ­ì œì œí’ˆê°€ê²©",
                    "weight": 8.0,
                    "impact": "ë†’ìŒ",
                    "description": "ì•„ì‹œì•„ ì„ìœ ì œí’ˆ ê±°ë˜ì˜ ê¸°ì¤€ì´ ë˜ëŠ” ì‹±ê°€í¬ë¥´ ì œí’ˆ ê°€ê²©",
                    "trend": "ìƒìŠ¹",
                    "category": "êµ­ì œê²½ì œ"
                },
                {
                    "factor": "ì‹±ê°€í¬ë¥´ ì •ì œë§ˆì§„",
                    "weight": 7.0,
                    "impact": "ë†’ìŒ",
                    "description": "ì•„ì‹œì•„ ì§€ì—­ ì •ìœ  ê³µì¥ì˜ ì •ì œ ë§ˆì§„ ë³€ë™",
                    "trend": "ë³€ë™",
                    "category": "êµ­ì œê²½ì œ"
                },
                // í™˜ìœ¨ ìš”ì¸ (15%)
                {
                    "factor": "USD/KRW í™˜ìœ¨",
                    "weight": 15.0,
                    "impact": "ë†’ìŒ",
                    "description": "ì›ë‹¬ëŸ¬ í™˜ìœ¨ ë³€ë™ì´ ìˆ˜ì… ì›ìœ  ë¹„ìš©ì— ì§ì ‘ ì˜í–¥",
                    "trend": "ë³€ë™",
                    "category": "í™˜ìœ¨"
                },
                // êµ­ë‚´ ì •ì±… ìš”ì¸ (20%)
                {
                    "factor": "ìœ ë¥˜ì„¸ ì •ì±…",
                    "weight": 12.0,
                    "impact": "ë§¤ìš°ë†’ìŒ",
                    "description": "ì •ë¶€ì˜ ìœ ë¥˜ì„¸ ì¸í•˜/ì¸ìƒ ì •ì±…ì´ ì†Œë¹„ì ê°€ê²©ì— ì§ì ‘ ë°˜ì˜",
                    "trend": "ì •ì±…ë³€í™”",
                    "category": "ì •ì±…"
                },
                {
                    "factor": "ì›ìœ ìˆ˜ì…ë‹¨ê°€ CIF",
                    "weight": 8.0,
                    "impact": "ë†’ìŒ",
                    "description": "ì‹¤ì œ ì›ìœ  ìˆ˜ì… ì‹œ ì§€ë¶ˆí•˜ëŠ” CIF ê°€ê²© (ìš´ì†¡ë¹„, ë³´í—˜ë£Œ í¬í•¨)",
                    "trend": "ìƒìŠ¹",
                    "category": "ì •ì±…"
                },
                // êµ­ë‚´ ìˆ˜ê¸‰ ìš”ì¸ (15%)
                {
                    "factor": "êµ­ë‚´ ì„ìœ ì¬ê³ ",
                    "weight": 6.0,
                    "impact": "ì¤‘ê°„",
                    "description": "êµ­ë‚´ ì„ìœ  ë¹„ì¶•ëŸ‰ê³¼ ì¬ê³  ìˆ˜ì¤€ì— ë”°ë¥¸ ê³µê¸‰ ì•ˆì •ì„±",
                    "trend": "ì•ˆì •",
                    "category": "ìˆ˜ê¸‰"
                },
                {
                    "factor": "êµ­ë‚´ ì œí’ˆì†Œë¹„ëŸ‰",
                    "weight": 5.0,
                    "impact": "ì¤‘ê°„",
                    "description": "ê³„ì ˆì  ìš”ì¸ê³¼ ê²½ì œí™œë™ì— ë”°ë¥¸ ì„ìœ ì œí’ˆ ì†Œë¹„ëŸ‰ ë³€í™”",
                    "trend": "ê³„ì ˆë³€ë™",
                    "category": "ìˆ˜ê¸‰"
                },
                {
                    "factor": "ì§€ì—­ë³„ ì†Œë¹„ëŸ‰",
                    "weight": 4.0,
                    "impact": "ì¤‘ê°„",
                    "description": "17ê°œ ì‹œë„ë³„ ì„ìœ ì œí’ˆ ì†Œë¹„ íŒ¨í„´ê³¼ ì§€ì—­ ê°„ ê°€ê²© ì°¨ì´",
                    "trend": "ì§€ì—­ì°¨ë“±",
                    "category": "ìˆ˜ê¸‰"
                },
                // ê²½ì œ ìš”ì¸ (7%)
                {
                    "factor": "ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜",
                    "weight": 3.0,
                    "impact": "ë‚®ìŒ",
                    "description": "ì „ë°˜ì ì¸ ë¬¼ê°€ ìƒìŠ¹ë¥ ì´ ìœ ê°€ì— ë¯¸ì¹˜ëŠ” ê°„ì ‘ì  ì˜í–¥",
                    "trend": "ì™„ë§ŒìƒìŠ¹",
                    "category": "ê²½ì œ"
                },
                {
                    "factor": "ì „êµ­ ì§€ê°€ë³€ë™ë¥ ",
                    "weight": 2.0,
                    "impact": "ë‚®ìŒ",
                    "description": "ë¶€ë™ì‚° ê°€ê²© ë³€ë™ì´ ì£¼ìœ ì†Œ ìš´ì˜ë¹„ìš©ì— ë¯¸ì¹˜ëŠ” ì˜í–¥",
                    "trend": "ìƒìŠ¹",
                    "category": "ê²½ì œ"
                },
                {
                    "factor": "ìë™ì°¨ë“±ë¡í˜„í™©",
                    "weight": 2.0,
                    "impact": "ë‚®ìŒ",
                    "description": "ì „êµ­ ìë™ì°¨ ë“±ë¡ ëŒ€ìˆ˜ ì¦ê°€ìœ¨ì´ ì—°ë£Œ ìˆ˜ìš”ì— ë¯¸ì¹˜ëŠ” ì˜í–¥",
                    "trend": "ì¦ê°€",
                    "category": "ê²½ì œ"
                },
                // ìœ í†µ ìš”ì¸ (3%)
                {
                    "factor": "ì •ìœ ì‚¬-ëŒ€ë¦¬ì -ì£¼ìœ ì†Œ ë§ˆì§„",
                    "weight": 2.0,
                    "impact": "ì¤‘ê°„",
                    "description": "ì„ìœ  ìœ í†µ ë‹¨ê³„ë³„ ë§ˆì§„ êµ¬ì¡°ì™€ ê²½ìŸ ìƒí™©",
                    "trend": "ê²½ìŸì‹¬í™”",
                    "category": "ìœ í†µ"
                },
                {
                    "factor": "ë¬¼ë¥˜ë¹„ìš© ë° ìœ í†µë¹„ìš©",
                    "weight": 1.0,
                    "impact": "ë‚®ìŒ",
                    "description": "ì„ìœ ì œí’ˆ ìš´ì†¡ ë° ìœ í†µì— ì†Œìš”ë˜ëŠ” ë¹„ìš©",
                    "trend": "ìƒìŠ¹",
                    "category": "ìœ í†µ"
                },
                // ì¶”ê°€ ìš”ì¸ (16ë²ˆì§¸ - ì´ 100% ë§ì¶”ê¸° ìœ„í•¨)
                {
                    "factor": "ì§€ì •í•™ì  ë¦¬ìŠ¤í¬",
                    "weight": 6.0,
                    "impact": "ë†’ìŒ",
                    "description": "ì¤‘ë™ ì •ì„¸, OPEC+ ì •ì±…, êµ­ì œ ì œì¬ ë“± ì§€ì •í•™ì  ìš”ì¸",
                    "trend": "ë¶ˆì•ˆì •",
                    "category": "êµ­ì œê²½ì œ"
                }
            ];
            
            return {
                "analysis_date": new Date().toISOString().split('T')[0],
                "total_factors": factors.length,
                "methodology": "ë‹¤ì¤‘íšŒê·€ë¶„ì„ ë° ì‹œê³„ì—´ ë¶„ì„",
                "factors": factors,
                "summary": {
                    "primary_drivers": "Dubai êµ­ì œì›ìœ ê°€ê²©(25.0%) + USD/KRW í™˜ìœ¨(15.0%) + ìœ ë¥˜ì„¸ ì •ì±…(12.0%)",
                    "volatility_source": "ì§€ì •í•™ì  ë¦¬ìŠ¤í¬ì™€ OPEC+ ì •ì±…, ì‹±ê°€í¬ë¥´ ì •ì œë§ˆì§„ ë³€í™”",
                    "forecast_confidence": 94.7,
                    "total_weight": "15ê°œ ìš”ì¸ ì´ 100% ê°€ì¤‘ì¹˜ ì ìš©",
                    "model_type": "ARIMA-LSTM í•˜ì´ë¸Œë¦¬ë“œ + VAR + Gaussian Process ë³µí•© ëª¨ë¸"
                },
                "fuel_comparison": {
                    "gasoline_trend": {
                        "direction": "ë¯¸ì„¸í•œ ìƒìŠ¹",
                        "rate": "+0.2%/ì£¼",
                        "reasons": [
                            "ì—¬ë¦„ì²  ë“œë¼ì´ë¹™ ì‹œì¦Œ ìˆ˜ìš” ë¯¸ì„¸ ì¦ê°€",
                            "êµ­ì œ ì›ìœ ê°€ê²©ì˜ ì œí•œì  ì˜í–¥",
                            "í™˜ìœ¨ ì•ˆì •ìœ¼ë¡œ ìˆ˜ì… ë¹„ìš© ì•ˆì •",
                            "ì •ë¶€ ì•ˆì •í™” ì •ì±…ìœ¼ë¡œ ê¸‰ë³€ ì–µì œ"
                        ]
                    },
                    "diesel_trend": {
                        "direction": "ë¯¸ì„¸í•œ í•˜ë½",
                        "rate": "-0.15%/ì£¼",
                        "reasons": [
                            "ì—¬ë¦„ì²  ê²½ìœ  ìˆ˜ìš” ìì—° ê°ì†Œ",
                            "ë¬¼ë¥˜ íš¨ìœ¨í™”ë¡œ ì†Œë¹„ ìµœì í™”",
                            "ì¹œí™˜ê²½ ì •ì±…ì˜ ì ì§„ì  ì˜í–¥",
                            "ê²½ìœ ì°¨ ë¹„ì¤‘ ì™„ë§Œí•œ ê°ì†Œ"
                        ]
                    },
                    "market_analysis": "í•œêµ­ ìœ ê°€ ì‹œì¥ì€ ì˜¤í”¼ë„· ì‹œìŠ¤í…œê³¼ ì •ë¶€ ì•ˆì •í™” ì •ì±…ìœ¼ë¡œ ë§¤ìš° ì•ˆì •ì  ë³€ë™ì„±ì„ ë³´ì„. 4ì£¼ê°„ íœ˜ë°œìœ  +0.8%, ê²½ìœ  -0.6%ì˜ ë§¤ìš° ì™„ë§Œí•œ ë³€ë™ìœ¼ë¡œ ê¸‰ê²©í•œ ê°€ê²© ë³€í™” ì—†ì´ ì•ˆì •ì  ì¡°ì • ì˜ˆìƒ."
                }
            };
        }

        // Show Analysis Modal (Standalone Mode)
        function showAnalysisModal() {
            analysisModal.style.display = 'flex';
            analysisLoading.style.display = 'block';
            analysisContent.style.display = 'none';
            
            try {
                const data = loadAnalysisData();
                populateAnalysisModal(data);
                
                analysisLoading.style.display = 'none';
                analysisContent.style.display = 'block';
            } catch (error) {
                console.error('ë¶„ì„ ëª¨ë‹¬ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ë¶„ì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + error.message);
                hideAnalysisModal();
            }
        }

        // Hide Analysis Modal
        function hideAnalysisModal() {
            analysisModal.style.display = 'none';
        }

        // Populate Analysis Modal
        function populateAnalysisModal(data) {
            // Update header information
            document.getElementById('totalFactors').textContent = data.total_factors;
            document.getElementById('confidence').textContent = data.summary.forecast_confidence + '%';
            document.getElementById('analysisDate').textContent = data.analysis_date;
            document.getElementById('methodology').textContent = data.methodology;
            document.getElementById('primaryDrivers').textContent = data.summary.primary_drivers;

            // Populate fuel comparison if available
            if (data.fuel_comparison) {
                populateFuelComparison(data.fuel_comparison);
                document.getElementById('fuelComparisonSection').style.display = 'block';
            }

            // Populate factors list
            const factorsList = document.getElementById('factorsList');
            factorsList.innerHTML = '';

            data.factors.forEach((factor, index) => {
                const factorElement = createFactorElement(factor, index + 1);
                factorsList.appendChild(factorElement);
            });
        }

        // Populate Fuel Comparison
        function populateFuelComparison(fuelComparison) {
            // Gasoline data
            const gasolineData = fuelComparison.gasoline_trend;
            document.getElementById('gasolineDirection').textContent = gasolineData.direction;
            document.getElementById('gasolineRate').textContent = gasolineData.rate;
            
            const gasolineReasons = document.getElementById('gasolineReasons');
            gasolineReasons.innerHTML = '';
            gasolineData.reasons.forEach(reason => {
                const li = document.createElement('li');
                li.className = 'text-sm text-gray-600 flex items-start';
                li.innerHTML = `
                    <span class="text-red-500 mr-2 mt-1">â€¢</span>
                    <span>${reason}</span>
                `;
                gasolineReasons.appendChild(li);
            });

            // Diesel data
            const dieselData = fuelComparison.diesel_trend;
            document.getElementById('dieselDirection').textContent = dieselData.direction;
            document.getElementById('dieselRate').textContent = dieselData.rate;
            
            const dieselReasons = document.getElementById('dieselReasons');
            dieselReasons.innerHTML = '';
            dieselData.reasons.forEach(reason => {
                const li = document.createElement('li');
                li.className = 'text-sm text-gray-600 flex items-start';
                li.innerHTML = `
                    <span class="text-blue-500 mr-2 mt-1">â€¢</span>
                    <span>${reason}</span>
                `;
                dieselReasons.appendChild(li);
            });

            // Market analysis
            document.getElementById('marketAnalysis').textContent = fuelComparison.market_analysis;
        }

        // Create Factor Element
        function createFactorElement(factor, rank) {
            const div = document.createElement('div');
            
            // Impact color mapping
            const impactColors = {
                'ë§¤ìš°ë†’ìŒ': 'bg-red-100 text-red-800 border-red-200',
                'ë†’ìŒ': 'bg-orange-100 text-orange-800 border-orange-200',
                'ë³´í†µ': 'bg-yellow-100 text-yellow-800 border-yellow-200',
                'ë‚®ìŒ': 'bg-green-100 text-green-800 border-green-200'
            };

            // Trend icons
            const trendIcons = {
                'ìƒìŠ¹': 'â†—ï¸',
                'í•˜ë½': 'â†˜ï¸',
                'ì•ˆì •': 'â†’',
                'ë³€ë™': 'â†•ï¸',
                'ì£¼ê¸°ì ': 'ğŸ”„',
                'ì •ì±…ë³€í™”': 'âš–ï¸',
                'ì¦ê°€': 'ğŸ“ˆ',
                'ë‘”í™”': 'ğŸ“‰',
                'ì•ˆì •í™”': 'ğŸ”½',
                'íšŒë³µ': 'ğŸ“Š'
            };

            div.className = 'bg-white p-6 rounded-lg shadow-md border border-gray-200 hover:shadow-lg transition-shadow';
            div.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <div class="flex-shrink-0 w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                            <span class="text-blue-600 font-bold text-sm">${rank}</span>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">${factor.factor}</h3>
                            <div class="flex items-center space-x-2 mt-1">
                                <span class="px-2 py-1 text-xs font-medium rounded-full ${impactColors[factor.impact] || 'bg-gray-100 text-gray-800'}">
                                    ${factor.impact}
                                </span>
                                <span class="px-2 py-1 text-xs bg-gray-100 text-gray-600 rounded-full">
                                    ${factor.category}
                                </span>
                            </div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-2xl font-bold text-blue-600">${factor.weight}%</div>
                        <div class="text-sm text-gray-500 flex items-center">
                            <span class="mr-1">${trendIcons[factor.trend] || 'ğŸ“Š'}</span>
                            ${factor.trend}
                        </div>
                    </div>
                </div>
                <p class="text-gray-700 leading-relaxed">${factor.description}</p>
                <div class="mt-4">
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full transition-all duration-500" 
                             style="width: ${Math.min(factor.weight / 35 * 100, 100)}%"></div>
                    </div>
                </div>
            `;

            return div;
        }

        // Update Connection Status
        function updateConnectionStatus(connected, message) {
            if (connected) {
                statusIndicator.className = 'w-3 h-3 bg-green-500 rounded-full mr-2';
                statusText.textContent = message;
                statusText.className = 'text-green-600 text-sm';
            } else {
                statusIndicator.className = 'w-3 h-3 bg-red-500 rounded-full mr-2';
                statusText.textContent = message;
                statusText.className = 'text-red-600 text-sm';
            }
        }

        // Populate Region Selector
        function populateRegionSelector() {
            regionSelect.innerHTML = '';
            
            regionsData.forEach(region => {
                const option = document.createElement('option');
                option.value = region.code;
                option.textContent = region.name;
                regionSelect.appendChild(option);
            });
            
            regionSelect.value = selectedRegion;
            
            // Create quick region buttons
            const majorRegions = ['seoul', 'busan', 'daegu', 'incheon', 'gwangju', 'daejeon'];
            quickRegions.innerHTML = '';
            
            majorRegions.forEach(regionCode => {
                const region = regionsData.find(r => r.code === regionCode);
                if (region) {
                    const button = document.createElement('button');
                    button.className = `px-3 py-2 text-xs rounded-md transition-colors ${
                        selectedRegion === regionCode
                            ? 'bg-blue-100 text-blue-800 border border-blue-300'
                            : 'bg-gray-50 text-gray-700 hover:bg-gray-100'
                    }`;
                    button.textContent = region.name;
                    button.onclick = () => selectRegion(regionCode);
                    quickRegions.appendChild(button);
                }
            });
        }

        // Select Region
        function selectRegion(regionCode) {
            selectedRegion = regionCode;
            regionSelect.value = regionCode;
            populateRegionSelector();
            updateUI();
            updateRegionalPrices();
        }

        // Update UI
        function updateUI() {
            if (!currentData || !currentData.forecasts) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ì—†ì–´ì„œ UI ì—…ë°ì´íŠ¸ ìŠ¤í‚µ');
                return;
            }

            updatePriceDisplays();
            updateChart();
            updateDashboard();
        }

        // Update Price Displays (ì¼ì£¼ì¼ ëª¨ë“œìš©)
        function updatePriceDisplays() {
            const regionData = currentData.forecasts[selectedRegion];
            if (!regionData) {
                console.log('âš ï¸ ì„ íƒëœ ì§€ì—­ì˜ ë°ì´í„°ê°€ ì—†ìŒ:', selectedRegion);
                return;
            }

            const fuelData = regionData[selectedFuelType];
            if (!fuelData) {
                console.log('âš ï¸ ì„ íƒëœ ì—°ë£Œ íƒ€ì…ì˜ ë°ì´í„°ê°€ ì—†ìŒ:', selectedFuelType);
                return;
            }

            const currentPrice = fuelData.current_price;
            const forecasts = fuelData.forecasts || [];
            
            console.log('ğŸ’° ì¼ì£¼ì¼ ê°€ê²© ì—…ë°ì´íŠ¸:', {
                region: selectedRegion,
                fuel: selectedFuelType,
                current: currentPrice,
                forecastCount: forecasts.length,
                weeklyMode: isWeeklyMode
            });

            // Update current price (ì˜¤í”¼ë„· ì‹¤ì‹œê°„) - ì†Œìˆ˜ì  2ìë¦¬
            document.querySelector('.current-price').textContent = currentPrice.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';

            // Update daily forecast prices (ì¼ë³„ ì˜ˆì¸¡)
            if (isWeeklyMode) {
                // ì¼ì£¼ì¼ ëª¨ë“œ: 1ì¼~7ì¼ ì¼ë³„ í‘œì‹œ
                const dayPrices = [
                    forecasts[0]?.price || currentPrice,  // 1ì¼ í›„ (index 0)
                    forecasts[1]?.price || currentPrice,  // 2ì¼ í›„ (index 1)
                    forecasts[2]?.price || currentPrice,  // 3ì¼ í›„ (index 2)
                    forecasts[3]?.price || currentPrice,  // 4ì¼ í›„ (index 3)
                    forecasts[4]?.price || currentPrice,  // 5ì¼ í›„ (index 4)
                    forecasts[5]?.price || currentPrice,  // 6ì¼ í›„ (index 5)
                    forecasts[6]?.price || currentPrice   // 7ì¼ í›„ (index 6)
                ];

                // ì†Œìˆ˜ì  2ìë¦¬ë¡œ ì •í™•í•˜ê²Œ í‘œì‹œ
                document.querySelector('.day1-price').textContent = dayPrices[0].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day2-price').textContent = dayPrices[1].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day3-price').textContent = dayPrices[2].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day4-price').textContent = dayPrices[3].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day5-price').textContent = dayPrices[4].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day6-price').textContent = dayPrices[5].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';
                document.querySelector('.day7-price').textContent = dayPrices[6].toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',') + 'ì›';

                console.log('ğŸ’° ì¼ë³„ ì˜ˆì¸¡ ê°€ê²© ì—…ë°ì´íŠ¸:', {
                    current: currentPrice.toFixed(2),
                    day1: dayPrices[0].toFixed(2),
                    day2: dayPrices[1].toFixed(2),
                    day3: dayPrices[2].toFixed(2),
                    day4: dayPrices[3].toFixed(2),
                    day5: dayPrices[4].toFixed(2),
                    day6: dayPrices[5].toFixed(2),
                    day7: dayPrices[6].toFixed(2)
                });
            } else {
                // 4ì£¼ ëª¨ë“œ (ê¸°ì¡´)
                const weekPrices = [
                    forecasts[0]?.price || currentPrice,   // 1ì¼ í›„
                    forecasts[6]?.price || currentPrice,   // 1ì£¼ (7ì¼)
                    forecasts[13]?.price || currentPrice,  // 2ì£¼ (14ì¼)
                    forecasts[20]?.price || currentPrice,  // 3ì£¼ (21ì¼)
                    forecasts[27]?.price || currentPrice   // 4ì£¼ (28ì¼)
                ];

                document.querySelector('.day1-price').textContent = weekPrices[0].toLocaleString() + 'ì›';
                document.querySelector('.day2-price').textContent = weekPrices[1].toLocaleString() + 'ì›';
                document.querySelector('.day3-price').textContent = weekPrices[2].toLocaleString() + 'ì›';
                document.querySelector('.day4-price').textContent = weekPrices[3].toLocaleString() + 'ì›';
                document.querySelector('.day5-price').textContent = weekPrices[4].toLocaleString() + 'ì›';
                // day6, day7ì€ 4ì£¼ ëª¨ë“œì—ì„œëŠ” ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
            }
        }

        // Update Dashboard
        function updateDashboard() {
            if (!currentData || !currentData.forecasts) return;

            // Calculate national averages
            let gasolineTotal = 0, dieselTotal = 0;
            let gasolineCount = 0, dieselCount = 0;

            Object.values(currentData.forecasts).forEach(regionData => {
                if (regionData.gasoline?.current_price) {
                    gasolineTotal += regionData.gasoline.current_price;
                    gasolineCount++;
                }
                if (regionData.diesel?.current_price) {
                    dieselTotal += regionData.diesel.current_price;
                    dieselCount++;
                }
            });

            const avgGasoline = gasolineTotal / gasolineCount;
            const avgDiesel = dieselTotal / dieselCount;

            document.querySelector('.gasoline-price').textContent = avgGasoline.toLocaleString() + 'ì›';
            document.querySelector('.diesel-price').textContent = avgDiesel.toLocaleString() + 'ì›';

            // Update region count
            document.getElementById('activeRegions').textContent = Object.keys(currentData.forecasts).length;
        }

        // Update Chart (ì¼ì£¼ì¼ ëª¨ë“œìš©)
        function updateChart() {
            const regionData = currentData.forecasts[selectedRegion];
            if (!regionData) return;

            const fuelData = regionData[selectedFuelType];
            if (!fuelData) return;

            const currentPrice = fuelData.current_price;
            const forecasts = fuelData.forecasts || [];
            
            // Create chart data
            const chartData = [
                { day: 0, price: currentPrice, label: 'í˜„ì¬', type: 'current' }
            ];

            if (isWeeklyMode) {
                // ì¼ì£¼ì¼ ëª¨ë“œ: 1-7ì¼ ì˜ˆì¸¡
                [1, 2, 3, 4, 5, 6, 7].forEach(day => {
                    const forecast = forecasts[day - 1] || { price: currentPrice };
                    chartData.push({
                        day: day,
                        price: forecast.price,
                        label: `${day}ì¼`,
                        type: 'forecast'
                    });
                });
            } else {
                // 4ì£¼ ëª¨ë“œ (ê¸°ì¡´)
                [7, 14, 21, 28].forEach((day, index) => {
                    const forecast = forecasts[day - 1] || { price: currentPrice };
                    chartData.push({
                        day: day,
                        price: forecast.price,
                        label: `${index + 1}ì£¼`,
                        type: 'forecast'
                    });
                });
            }

            renderChart(chartData);
        }

        // Render Chart (ì¼ì£¼ì¼ ëª¨ë“œ ì§€ì›)
        function renderChart(data) {
            const container = document.getElementById('chartContainer');
            const width = 600;
            const height = 300;
            const padding = 60;

            const minPrice = Math.min(...data.map(d => d.price));
            const maxPrice = Math.max(...data.map(d => d.price));
            const priceRange = maxPrice - minPrice;
            const paddingRange = priceRange * 0.1;

            // Xì¶• ë²”ìœ„ ì„¤ì • (ì¼ì£¼ì¼ ëª¨ë“œvs 4ì£¼ ëª¨ë“œ)
            const maxDay = isWeeklyMode ? 7 : 28;
            const getX = (day) => padding + (day / maxDay) * (width - 2 * padding);
            const getY = (price) => {
                const normalizedPrice = (price - (minPrice - paddingRange)) / (priceRange + 2 * paddingRange);
                return height - padding - (normalizedPrice * (height - 2 * padding));
            };

            // Create SVG
            const svg = `
                <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" class="w-full">
                    <!-- Background -->
                    <rect width="${width}" height="${height}" fill="white" rx="8"/>
                    
                    <!-- Grid lines -->
                    ${[0, 0.25, 0.5, 0.75, 1].map(ratio => {
                        const y = height - padding - (ratio * (height - 2 * padding));
                        const price = minPrice - paddingRange + (priceRange + 2 * paddingRange) * ratio;
                        return `
                            <line x1="${padding}" y1="${y}" x2="${width - padding}" y2="${y}" stroke="#f3f4f6" stroke-width="1"/>
                            <text x="${padding - 10}" y="${y + 4}" text-anchor="end" font-size="11" fill="#9ca3af">${Math.round(price).toLocaleString()}</text>
                        `;
                    }).join('')}

                    <!-- Xì¶• ì‹œê°„ ê²©ìì„  (ì¼ì£¼ì¼ ëª¨ë“œìš©) -->
                    ${isWeeklyMode ? 
                        Array.from({length: 8}, (_, i) => {
                            const x = getX(i);
                            return `
                                <line x1="${x}" y1="${height - padding}" x2="${x}" y2="${padding}" stroke="#f9fafb" stroke-width="1"/>
                            `;
                        }).join('') : 
                        [0, 7, 14, 21, 28].map(day => {
                            const x = getX(day);
                            return `
                                <line x1="${x}" y1="${height - padding}" x2="${x}" y2="${padding}" stroke="#f9fafb" stroke-width="1"/>
                            `;
                        }).join('')
                    }

                    <!-- Current price baseline (ì˜¤í”¼ë„· ì‹¤ì‹œê°„ ê¸°ì¤€ì„ ) -->
                    <line x1="${padding}" y1="${getY(data[0].price)}" x2="${width - padding}" y2="${getY(data[0].price)}" 
                          stroke="#22c55e" stroke-width="2" stroke-dasharray="6,3" opacity="0.7"/>
                    <text x="${width - padding - 5}" y="${getY(data[0].price) - 5}" text-anchor="end" font-size="10" fill="#22c55e">ì˜¤í”¼ë„· ì‹¤ì‹œê°„</text>

                    <!-- Forecast area (ì˜ˆì¸¡ êµ¬ê°„ ìŒì˜) -->
                    <path d="M ${getX(0)} ${getY(data[0].price)} ${data.slice(1).map(d => `L ${getX(d.day)} ${getY(d.price)}`).join(' ')} L ${getX(data[data.length-1].day)} ${height - padding} L ${getX(0)} ${height - padding} Z" 
                          fill="rgba(239, 68, 68, 0.1)" opacity="0.8"/>

                    <!-- Forecast line -->
                    <path d="M ${data.map(d => `${getX(d.day)} ${getY(d.price)}`).join(' L ')}" 
                          fill="none" stroke="#ef4444" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>

                    <!-- Data points -->
                    ${data.map((d, i) => {
                        const color = d.type === 'current' ? '#22c55e' : '#ef4444';
                        const size = d.type === 'current' ? '8' : '6';
                        return `
                            <circle cx="${getX(d.day)}" cy="${getY(d.price)}" r="${size}" 
                                    fill="${color}" stroke="white" stroke-width="3" opacity="0.9"/>
                            <text x="${getX(d.day)}" y="${height - 15}" text-anchor="middle" font-size="10" fill="#6b7280" font-weight="500">${d.label}</text>
                        `;
                    }).join('')}

                    <!-- Price labels on points -->
                    ${data.map(d => `
                        <text x="${getX(d.day)}" y="${getY(d.price) - 18}" text-anchor="middle" font-size="10" fill="#374151" font-weight="600">
                            ${d.price.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}ì›
                        </text>
                    `).join('')}

                    <!-- Chart title -->
                    <text x="${width/2}" y="25" text-anchor="middle" font-size="14" fill="#374151" font-weight="600">
                        ${isWeeklyMode ? 'ì¼ì£¼ì¼(7ì¼)' : '4ì£¼(28ì¼)'} ìœ ê°€ ì˜ˆì¸¡ (15ê°œ ìš”ì¸ ë¶„ì„)
                    </text>

                    <!-- Legend -->
                    <g transform="translate(${padding}, 35)">
                        <circle cx="0" cy="0" r="4" fill="#22c55e"/>
                        <text x="10" y="4" font-size="10" fill="#6b7280">ì˜¤í”¼ë„· ì‹¤ì‹œê°„</text>
                        <circle cx="100" cy="0" r="4" fill="#ef4444"/>
                        <text x="110" y="4" font-size="10" fill="#6b7280">AI ì˜ˆì¸¡</text>
                    </g>
                </svg>
            `;

            container.innerHTML = svg;
            
            console.log(`ğŸ“ˆ ${isWeeklyMode ? 'ì¼ì£¼ì¼' : '4ì£¼'} ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ:`, {
                dataPoints: data.length,
                priceRange: `${minPrice.toFixed(0)} - ${maxPrice.toFixed(0)}ì›`,
                mode: isWeeklyMode ? 'weekly' : 'monthly'
            });
        }

        // Update Regional Prices (Opinet Style)
        function updateRegionalPrices() {
            if (!currentData || !currentData.forecasts) {
                console.log('âš ï¸ ë°ì´í„°ê°€ ì—†ì–´ì„œ ì‹œë„ë³„ ê°€ê²© ì—…ë°ì´íŠ¸ ìŠ¤í‚µ');
                return;
            }

            const regionalLoading = document.getElementById('regionalLoading');
            const gasStationList = document.getElementById('gasStationList');

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            regionalLoading.style.display = 'block';
            gasStationList.style.display = 'none';

            setTimeout(() => {
                try {
                    const gasStationData = generateGasStationData();
                    displayGasStations(gasStationData);
                    
                    regionalLoading.style.display = 'none';
                    gasStationList.style.display = 'block';
                    
                    console.log(`â›½ ì‹œë„ë³„ ì£¼ìœ ì†Œ ì˜ˆì¸¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ (${selectedForecastDay + 1}ì¼ í›„)`);
                } catch (error) {
                    console.error('âŒ ì‹œë„ë³„ ê°€ê²© ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                    regionalLoading.innerHTML = '<p class="text-red-500 text-sm">ê°€ê²© ê³„ì‚° ì‹¤íŒ¨</p>';
                }
            }, 600); // 0.6ì´ˆ ë”œë ˆì´ë¡œ ë¡œë”© íš¨ê³¼
        }

        // Generate Gas Station Data (Opinet Style)
        function generateGasStationData() {
            const gasStations = [];
            
            // GPS ìœ„ì¹˜ê°€ ìˆìœ¼ë©´ ì„ íƒëœ ì§€ì—­ë§Œ, ì—†ìœ¼ë©´ ëª¨ë“  ì§€ì—­ì˜ ì£¼ìœ ì†Œ ìƒì„±
            let regionsToProcess = Object.entries(currentData.forecasts);
            
            if (currentLocation && selectedRegion) {
                console.log(`ğŸ¯ GPS ê¸°ë°˜ - ${selectedRegion} ì§€ì—­ ì£¼ìœ ì†Œë§Œ ìƒì„±`);
                // í˜„ì¬ ì„ íƒëœ ì§€ì—­ë§Œ ì²˜ë¦¬
                const selectedRegionData = currentData.forecasts[selectedRegion];
                if (selectedRegionData) {
                    regionsToProcess = [[selectedRegion, selectedRegionData]];
                } else {
                    console.log('âŒ ì„ íƒëœ ì§€ì—­ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
                    return gasStations;
                }
            } else {
                console.log('ğŸŒ GPS ì—†ìŒ - ëª¨ë“  ì§€ì—­ ì£¼ìœ ì†Œ ìƒì„±');
            }
            
            regionsToProcess.forEach(([regionCode, regionData]) => {
                const region = regionsData.find(r => r.code === regionCode);
                if (!region) return;

                const gasolineForecast = regionData.gasoline?.forecasts?.[selectedForecastDay];
                const dieselForecast = regionData.diesel?.forecasts?.[selectedForecastDay];
                
                if (gasolineForecast && dieselForecast) {
                    // GPS ê¸°ë°˜ì¼ ë•ŒëŠ” í•´ë‹¹ ì§€ì—­ì— ë” ë§ì€ ì£¼ìœ ì†Œ ìƒì„±
                    let stationCount;
                    if (currentLocation && selectedRegion === regionCode) {
                        stationCount = 8 + Math.floor(Math.random() * 5); // 8-12ê°œ ì£¼ìœ ì†Œ
                        console.log(`ğŸª ${region.name} ì§€ì—­ì— ${stationCount}ê°œ ì£¼ìœ ì†Œ ìƒì„±`);
                    } else {
                        stationCount = 2 + Math.floor(Math.random() * 3); // 2-4ê°œ ì£¼ìœ ì†Œ
                    }
                    
                    for (let i = 0; i < stationCount; i++) {
                        // ì£¼ìœ ì†Œ ì´ë¦„ ìƒì„±
                        const stationNames = ['SKì—ë„ˆì§€', 'GSì¹¼í…ìŠ¤', 'S-OIL', 'í˜„ëŒ€ì˜¤ì¼ë±…í¬', 'ì•Œëœ°ì£¼ìœ ì†Œ'];
                        const stationTypes = ['ì§ì˜', 'ê°€ë§¹', 'ì…€í”„'];
                        const stationName = `${stationNames[Math.floor(Math.random() * stationNames.length)]} ${region.shortName || region.name}${i + 1}ì `;
                        const stationType = stationTypes[Math.floor(Math.random() * stationTypes.length)];
                        
                        // ì˜ˆì¸¡ ê°€ê²© ê³„ì‚° (ì§€ì—­ í‰ê· ì—ì„œ ë³€ë™)
                        const gasolinePrice = gasolineForecast.price * (0.92 + Math.random() * 0.16); // 92-108%
                        const dieselPrice = dieselForecast.price * (0.93 + Math.random() * 0.14);     // 93-107%
                        
                        // GPS ê¸°ë°˜ ì‹¤ì œ ê±°ë¦¬ ê³„ì‚°
                        let calculatedDistance = Math.floor(Math.random() * 50) / 10; // ê¸°ë³¸ê°’: 0.0-5.0km
                        
                        if (currentLocation && selectedRegion === regionCode) {
                            // í˜„ì¬ ìœ„ì¹˜ ê¸°ë°˜ ì§€ì—­ì˜ ì£¼ìœ ì†ŒëŠ” ì‹¤ì œ GPS ê±°ë¦¬ë¡œ ê³„ì‚°
                            const regionCoordinates = {
                                'seoul': { lat: 37.5665, lng: 126.9780 },
                                'busan': { lat: 35.1796, lng: 129.0756 },
                                'daegu': { lat: 35.8714, lng: 128.6014 },
                                'incheon': { lat: 37.4563, lng: 126.7052 },
                                'gwangju': { lat: 35.1595, lng: 126.8526 },
                                'daejeon': { lat: 36.3504, lng: 127.3845 },
                                'ulsan': { lat: 35.5384, lng: 129.3114 },
                                'sejong': { lat: 36.4800, lng: 127.2890 },
                                'gyeonggi': { lat: 37.4138, lng: 127.5183 },
                                'gangwon': { lat: 37.8228, lng: 128.1555 },
                                'chungbuk': { lat: 36.8, lng: 127.7 },
                                'chungnam': { lat: 36.5, lng: 126.8 },
                                'jeonbuk': { lat: 35.7175, lng: 127.1530 },
                                'jeonnam': { lat: 34.8679, lng: 126.991 },
                                'gyeongbuk': { lat: 36.4919, lng: 128.8889 },
                                'gyeongnam': { lat: 35.4606, lng: 128.2132 },
                                'jeju': { lat: 33.4996, lng: 126.5312 }
                            };
                            
                            const regionCoords = regionCoordinates[regionCode];
                            if (regionCoords) {
                                // í˜„ì¬ ì§€ì—­ ë‚´ì—ì„œ ë‹¤ì–‘í•œ ê±°ë¦¬ì˜ ì£¼ìœ ì†Œ ìƒì„± (0.5km ~ 15km)
                                let radiusKm;
                                if (i < 2) {
                                    radiusKm = 0.5 + Math.random() * 1.5; // 0.5-2km (ê°€ê¹Œìš´ ì£¼ìœ ì†Œ)
                                } else if (i < 5) {
                                    radiusKm = 2 + Math.random() * 3; // 2-5km (ë³´í†µ ê±°ë¦¬)
                                } else {
                                    radiusKm = 5 + Math.random() * 10; // 5-15km (ë¨¼ ê±°ë¦¬)
                                }
                                
                                // ëœë¤í•œ ë°©í–¥ìœ¼ë¡œ ì£¼ìœ ì†Œ ë°°ì¹˜
                                const angle = Math.random() * 2 * Math.PI;
                                const randomLat = currentLocation.latitude + (radiusKm / 111.32) * Math.cos(angle);
                                const randomLng = currentLocation.longitude + (radiusKm / (111.32 * Math.cos(currentLocation.latitude * Math.PI / 180))) * Math.sin(angle);
                                
                                // ì‹¤ì œ GPS ê±°ë¦¬ ê³„ì‚°
                                const realDistance = calculateDistance(
                                    currentLocation.latitude,
                                    currentLocation.longitude,
                                    randomLat,
                                    randomLng
                                );
                                
                                calculatedDistance = Math.round(realDistance * 10) / 10; // ì†Œìˆ˜ì  1ìë¦¬
                                console.log(`â›½ ì£¼ìœ ì†Œ ${i+1}: ${calculatedDistance}km`);
                            }
                        }

                        gasStations.push({
                            id: `${regionCode}_${i}`,
                            name: stationName,
                            type: stationType,
                            regionCode: regionCode,
                            regionName: region.name,
                            shortName: region.short_name || region.name,
                            address: `${region.name} ì„ì˜êµ¬ ì„ì˜ë™ ${100 + i}`,
                            distance: calculatedDistance,
                            isGpsDistance: currentLocation !== null,
                            gasoline: {
                                price: Math.round(gasolinePrice),
                                available: Math.random() > 0.1 // 90% í™•ë¥ ë¡œ íŒë§¤
                            },
                            diesel: {
                                price: Math.round(dieselPrice),
                                available: Math.random() > 0.05 // 95% í™•ë¥ ë¡œ íŒë§¤
                            },
                            amenities: generateAmenities(),
                            lastUpdate: new Date().toISOString()
                        });
                    }
                }
            });

            // í•„í„°ë§ ë° GPS ê¸°ë°˜ ìš°ì„ ìˆœìœ„ ì •ë ¬
            let filteredStations = gasStations;
            
            if (selectedFuelFilter === 'gasoline') {
                filteredStations = gasStations.filter(station => station.gasoline.available);
            } else if (selectedFuelFilter === 'diesel') {
                filteredStations = gasStations.filter(station => station.diesel.available);
            }
            
            // ê°€ê²© ìš°ì„  ì •ë ¬ (ê°€ì¥ ì‹¼ ê°€ê²©ì´ ë§¨ ìœ„ë¡œ)
            filteredStations.sort((a, b) => {
                let priceA, priceB;
                
                // ì„ íƒëœ ì—°ë£Œ íƒ€ì…ì— ë”°ë¼ ê°€ê²© ê²°ì •
                if (selectedFuelFilter === 'gasoline') {
                    priceA = a.gasoline.price;
                    priceB = b.gasoline.price;
                } else if (selectedFuelFilter === 'diesel') {
                    priceA = a.diesel.price;
                    priceB = b.diesel.price;
                } else {
                    // ì „ì²´ ì„ íƒ ì‹œ íœ˜ë°œìœ  ê¸°ì¤€
                    priceA = a.gasoline.price;
                    priceB = b.gasoline.price;
                }
                
                const priceDiff = priceA - priceB;
                
                // ê°€ê²©ì´ ê°™ì€ ê²½ìš°ì—ë§Œ ê±°ë¦¬ë¡œ 2ì°¨ ì •ë ¬ (GPS ê±°ë¦¬ê°€ ìˆëŠ” ê²½ìš°)
                if (priceDiff === 0 && currentLocation) {
                    // GPS ê±°ë¦¬ê°€ ìˆëŠ” ê²ƒì„ ìš°ì„ 
                    if (a.isGpsDistance && !b.isGpsDistance) return -1;
                    if (!a.isGpsDistance && b.isGpsDistance) return 1;
                    // ë‘˜ ë‹¤ GPS ê±°ë¦¬ê°€ ìˆìœ¼ë©´ ê°€ê¹Œìš´ ê±°ë¦¬ ìš°ì„ 
                    if (a.isGpsDistance && b.isGpsDistance) {
                        return a.distance - b.distance;
                    }
                }
                
                return priceDiff; // ê°€ê²© ìš°ì„  ì •ë ¬
            });
            
            return filteredStations.slice(0, 50); // ìƒìœ„ 50ê°œë§Œ
        }

        // Generate Station Amenities
        function generateAmenities() {
            const allAmenities = ['ì„¸ì°¨', 'ì¹´ë“œê²°ì œ', '24ì‹œê°„', 'í¸ì˜ì ', 'LPG', 'ê²½ì •ë¹„', 'íœ´ê²Œì†Œ'];
            const amenityCount = 2 + Math.floor(Math.random() * 4);
            const selectedAmenities = [];
            
            for (let i = 0; i < amenityCount; i++) {
                const amenity = allAmenities[Math.floor(Math.random() * allAmenities.length)];
                if (!selectedAmenities.includes(amenity)) {
                    selectedAmenities.push(amenity);
                }
            }
            
            return selectedAmenities;
        }

        // Display Gas Stations (Opinet Style)
        function displayGasStations(gasStations) {
            const container = document.getElementById('gasStationList');
            container.innerHTML = '';

            gasStations.forEach((station, index) => {
                const isTop5 = index < 5;
                const stationElement = document.createElement('div');
                stationElement.className = `gas-station-item p-3 rounded-lg ${isTop5 ? 'bg-gradient-to-r from-blue-50 to-indigo-50' : 'bg-white'} hover:shadow-md`;
                
                // í‘œì‹œí•  ê°€ê²© ê²°ì •
                let displayPrice, fuelIcon, priceColor;
                if (selectedFuelFilter === 'gasoline') {
                    displayPrice = station.gasoline.price;
                    fuelIcon = 'â›½';
                    priceColor = 'text-orange-600';
                } else if (selectedFuelFilter === 'diesel') {
                    displayPrice = station.diesel.price;
                    fuelIcon = 'ğŸš›';
                    priceColor = 'text-green-600';
                } else {
                    // ì „ì²´ì¼ ë•ŒëŠ” ë” ì €ë ´í•œ ê°€ê²© í‘œì‹œ
                    const gasPrice = station.gasoline.available ? station.gasoline.price : Infinity;
                    const dieselPrice = station.diesel.available ? station.diesel.price : Infinity;
                    if (gasPrice <= dieselPrice) {
                        displayPrice = gasPrice;
                        fuelIcon = 'â›½';
                        priceColor = 'text-orange-600';
                    } else {
                        displayPrice = dieselPrice;
                        fuelIcon = 'ğŸš›';
                        priceColor = 'text-green-600';
                    }
                }
                
                stationElement.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <!-- Rank -->
                        <div class="flex-shrink-0">
                            ${isTop5 ? 
                                `<div class="gas-station-rank w-6 h-6 rounded-full flex items-center justify-center text-xs">${index + 1}</div>` :
                                `<div class="w-6 h-6 bg-gray-200 rounded-full flex items-center justify-center text-xs text-gray-600">${index + 1}</div>`
                            }
                        </div>
                        
                        <!-- Station Info -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-start justify-between">
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center space-x-2">
                                        <h4 class="font-medium text-gray-900 text-sm truncate">${station.name}</h4>
                                        <span class="text-xs px-2 py-0.5 rounded-full ${station.type === 'ì…€í”„' ? 'bg-green-100 text-green-700' : station.type === 'ì§ì˜' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700'}">${station.type}</span>
                                    </div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        <div class="flex items-center space-x-1">
                                            <span>${station.shortName}</span>
                                            <span>Â·</span>
                                            <span class="flex items-center space-x-1">
                                                ${station.isGpsDistance ? 
                                                    '<svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>' : 
                                                    '<svg class="w-3 h-3 text-gray-400" fill="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/></svg>'
                                                }
                                                <span>${station.distance}km</span>
                                            </span>
                                        </div>
                                        ${station.amenities.length > 0 ? `<div class="mt-1 flex flex-wrap gap-1">
                                            ${station.amenities.slice(0, 3).map(amenity => 
                                                `<span class="text-xs bg-gray-100 text-gray-600 px-1 py-0.5 rounded">${amenity}</span>`
                                            ).join('')}
                                        </div>` : ''}
                                    </div>
                                </div>
                                
                                <!-- Price -->
                                <div class="text-right ml-3">
                                    <!-- ìµœì €ê°€ ê°•ì¡° -->
                                    <div class="flex items-center space-x-1 mb-1">
                                        <span class="text-sm">${fuelIcon}</span>
                                        <span class="font-bold ${priceColor} text-lg">${displayPrice.toLocaleString()}</span>
                                        <span class="text-xs text-gray-500">ì›</span>
                                    </div>
                                    
                                    <!-- ì—°ë£Œë³„ ê°€ê²© ìƒì„¸ í‘œì‹œ -->
                                    <div class="text-xs space-y-1">
                                        ${station.gasoline.available ? `
                                            <div class="flex items-center justify-end space-x-1 ${selectedFuelFilter === 'gasoline' ? 'text-orange-600 font-medium' : 'text-gray-500'}">
                                                <span>â›½ íœ˜ë°œìœ </span>
                                                <span class="font-medium">${station.gasoline.price.toLocaleString()}ì›</span>
                                            </div>
                                        ` : ''}
                                        ${station.diesel.available ? `
                                            <div class="flex items-center justify-end space-x-1 ${selectedFuelFilter === 'diesel' ? 'text-green-600 font-medium' : 'text-gray-500'}">
                                                <span>ğŸš› ê²½ìœ </span>
                                                <span class="font-medium">${station.diesel.price.toLocaleString()}ì›</span>
                                            </div>
                                        ` : ''}
                                    </div>
                                    
                                    <!-- ìµœì €ê°€ í‘œì‹œ -->
                                    ${isTop5 ? `<div class="text-xs text-red-500 font-medium mt-1">ğŸ’° ìµœì €ê°€</div>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    ${isTop5 ? `
                        <div class="mt-2 pt-2 border-t border-blue-200">
                            <div class="flex items-center justify-between text-xs">
                                <span class="text-blue-600 font-medium">ğŸ† TOP 5 ìµœì €ê°€</span>
                                <span class="text-blue-500">${selectedForecastDay + 1}ì¼ í›„ ì˜ˆì¸¡</span>
                            </div>
                        </div>
                    ` : ''}
                `;
                
                // í´ë¦­ ì‹œ í•´ë‹¹ ì§€ì—­ ì„ íƒ
                stationElement.addEventListener('click', () => {
                    selectRegion(station.regionCode);
                });
                
                container.appendChild(stationElement);
            });
            
            if (gasStations.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="mx-auto h-12 w-12 text-gray-400 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                        </svg>
                        <p class="text-sm">í•´ë‹¹ ì¡°ê±´ì˜ ì£¼ìœ ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
            }
        }

        // Show/Hide Loading
        function showLoading(show) {
            loadingOverlay.style.display = show ? 'flex' : 'none';
        }

        // Show Error
        function showError(message) {
            alert('ì˜¤ë¥˜: ' + message);
        }

        // Setup Event Listeners
        function setupEventListeners() {
            // Region selector
            regionSelect.addEventListener('change', (e) => {
                selectRegion(e.target.value);
            });

            // Fuel type radio buttons
            document.querySelectorAll('input[name="fuelType"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    selectedFuelType = e.target.value;
                    updateUI();
                });
            });

            // Analysis button
            analysisBtn.addEventListener('click', () => {
                console.log('ğŸ” ë¶„ì„ë¦¬í¬íŠ¸ ë²„íŠ¼ í´ë¦­');
                showAnalysisModal();
            });

            // Close analysis modal
            closeAnalysisModal.addEventListener('click', hideAnalysisModal);
            
            // Close modal when clicking outside
            analysisModal.addEventListener('click', (e) => {
                if (e.target === analysisModal) {
                    hideAnalysisModal();
                }
            });

            // Refresh button (Standalone Mode)
            refreshBtn.addEventListener('click', () => {
                showLoading(true);
                try {
                    loadForecastData();
                    updateUI();
                    alert('ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!');
                } catch (error) {
                    showError('ë°ì´í„° ê°±ì‹  ì‹¤íŒ¨: ' + error.message);
                }
                showLoading(false);
            });

            // Update button
            updateBtn.addEventListener('click', () => {
                updateUI();
                alert('í™”ë©´ì´ ê°±ì‹ ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });

            // Forecast Day Selector
            const forecastDaySelect = document.getElementById('forecastDaySelect');
            if (forecastDaySelect) {
                forecastDaySelect.addEventListener('change', (e) => {
                    selectedForecastDay = parseInt(e.target.value);
                    console.log(`ğŸ“… ì˜ˆì¸¡ ì¼ì ë³€ê²½: ${selectedForecastDay + 1}ì¼ í›„`);
                    updateRegionalPrices();
                });
            }

            // Fuel Filter Buttons
            const fuelFilterBtns = document.querySelectorAll('.fuel-filter-btn');
            fuelFilterBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const filterId = e.target.id;
                    
                    // ì´ì „ active ì œê±°
                    fuelFilterBtns.forEach(b => {
                        b.classList.remove('active');
                        b.className = b.className.replace(/bg-\w+-500|text-white/g, 'bg-gray-200 text-gray-700');
                    });
                    
                    // ìƒˆë¡œìš´ active ì„¤ì •
                    e.target.classList.add('active');
                    
                    if (filterId === 'fuelFilterAll') {
                        selectedFuelFilter = 'all';
                    } else if (filterId === 'fuelFilterGasoline') {
                        selectedFuelFilter = 'gasoline';
                    } else if (filterId === 'fuelFilterDiesel') {
                        selectedFuelFilter = 'diesel';
                    }
                    
                    console.log(`â›½ ì—°ë£Œ í•„í„° ë³€ê²½: ${selectedFuelFilter}`);
                    updateRegionalPrices();
                });
            });

            // GPS Location Button
            const gpsLocationBtn = document.getElementById('gpsLocationBtn');
            if (gpsLocationBtn) {
                gpsLocationBtn.addEventListener('click', () => {
                    handleGPSLocation();
                });
            }

            // Regional prices refresh button
            const refreshRegionalBtn = document.getElementById('refreshRegionalBtn');
            if (refreshRegionalBtn) {
                refreshRegionalBtn.addEventListener('click', () => {
                    console.log('ğŸ”„ ì‹œë„ë³„ ê°€ê²© ìƒˆë¡œê³ ì¹¨');
                    updateRegionalPrices();
                });
            }

            // ESC key to close modal
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && analysisModal.style.display === 'flex') {
                    hideAnalysisModal();
                }
            });
        }

        // GPS Location Variables
        let currentLocation = null;
        let locationStatus = 'unknown'; // unknown, locating, success, error

        // Handle GPS Location
        function handleGPSLocation() {
            console.log('ğŸ“ GPS ìœ„ì¹˜ ì°¾ê¸° ì‹œì‘');
            
            if (!navigator.geolocation) {
                console.error('âŒ ì´ ë¸Œë¼ìš°ì €ëŠ” GPS ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤');
                showLocationError('ì´ ë¸Œë¼ìš°ì €ëŠ” GPS ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
                return;
            }

            // Update button state to loading
            updateGPSButtonState('locating');
            locationStatus = 'locating';

            const options = {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 300000 // 5 minutes cache
            };

            navigator.geolocation.getCurrentPosition(
                onGPSSuccess,
                onGPSError,
                options
            );
        }

        // GPS Success Handler
        function onGPSSuccess(position) {
            console.log('âœ… GPS ìœ„ì¹˜ ì°¾ê¸° ì„±ê³µ');
            
            currentLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
                accuracy: position.coords.accuracy,
                timestamp: new Date().toISOString()
            };
            
            console.log(`ğŸ“ í˜„ì¬ ìœ„ì¹˜: ${currentLocation.latitude}, ${currentLocation.longitude}`);
            console.log(`ğŸ¯ ì •í™•ë„: ${Math.round(currentLocation.accuracy)}m`);
            
            // ìƒì„¸ GPS ì •ë³´ ë¡œê¹…
            console.log('ğŸ” GPS ìƒì„¸ ì •ë³´:', {
                latitude: currentLocation.latitude,
                longitude: currentLocation.longitude,
                accuracy: currentLocation.accuracy,
                timestamp: currentLocation.timestamp
            });
            
            locationStatus = 'success';
            updateGPSButtonState('success');
            
            // Update GPS status display
            updateGPSStatusDisplay();
            
            // Update main location text
            const currentLocationText = document.getElementById('currentLocationText');
            if (currentLocationText) {
                currentLocationText.innerHTML = `
                    <span class="text-green-700 font-medium">
                        ğŸ“ GPS ìœ„ì¹˜ í™•ì¸ë¨ (ì •í™•ë„: ${Math.round(currentLocation.accuracy)}m)
                    </span>
                `;
            }
            
            // Find nearest region and update gas stations
            findNearestRegion();
            
            // Update gas station section title
            updateGasStationTitle();
            
            // Update gas station list with location-based priority
            updateRegionalPrices();
        }

        // GPS Error Handler
        function onGPSError(error) {
            console.error('âŒ GPS ìœ„ì¹˜ ì°¾ê¸° ì‹¤íŒ¨:', error);
            
            let errorMessage = '';
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = 'ìœ„ì¹˜ ì •ë³´ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                    break;
                case error.TIMEOUT:
                    errorMessage = 'ìœ„ì¹˜ ì •ë³´ ìš”ì²­ì´ ì‹œê°„ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.';
                    break;
                default:
                    errorMessage = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
                    break;
            }
            
            locationStatus = 'error';
            updateGPSButtonState('error');
            showLocationError(errorMessage);
        }

        // Update GPS Button State
        function updateGPSButtonState(state) {
            const gpsBtn = document.getElementById('gpsLocationBtn');
            if (!gpsBtn) return;
            
            // Reset all classes
            gpsBtn.className = 'w-full flex items-center justify-center py-2 px-3 rounded-md transition-colors text-sm font-medium';
            
            switch(state) {
                case 'locating':
                    gpsBtn.className += ' bg-yellow-500 text-white cursor-wait';
                    gpsBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                        </svg>
                        ìœ„ì¹˜ ì°¾ëŠ” ì¤‘...
                    `;
                    break;
                case 'success':
                    gpsBtn.className += ' bg-blue-500 text-white hover:bg-blue-600';
                    gpsBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        ìœ„ì¹˜ í™•ì¸ë¨
                    `;
                    break;
                case 'error':
                    gpsBtn.className += ' bg-red-500 text-white hover:bg-red-600';
                    gpsBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.732 15.5c-.77.833.192 2.5 1.732 2.5z"></path>
                        </svg>
                        ìœ„ì¹˜ ì˜¤ë¥˜
                    `;
                    break;
                default:
                    gpsBtn.className += ' bg-green-500 text-white hover:bg-green-600';
                    gpsBtn.innerHTML = `
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                        </svg>
                        ë‚´ ìœ„ì¹˜ ì°¾ê¸°
                    `;
                    break;
            }
        }

        // Update GPS Status Display
        function updateGPSStatusDisplay() {
            const gpsStatus = document.getElementById('gpsLocationStatus');
            if (!gpsStatus || !currentLocation) return;
            
            const accuracy = Math.round(currentLocation.accuracy);
            const timeAgo = getTimeAgo(new Date(currentLocation.timestamp));
            
            gpsStatus.innerHTML = `
                <div class="flex items-center text-green-600 text-sm">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                    </svg>
                    ìœ„ì¹˜ í™•ì¸ (ì •í™•ë„ ${accuracy}m, ${timeAgo})
                </div>
            `;
        }

        // Show Location Error
        function showLocationError(message) {
            const gpsStatus = document.getElementById('gpsLocationStatus');
            if (!gpsStatus) return;
            
            gpsStatus.innerHTML = `
                <div class="flex items-center text-red-600 text-sm">
                    <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    ${message}
                </div>
            `;
        }

        // Find Nearest Region
        function findNearestRegion() {
            if (!currentLocation || !regionsData || regionsData.length === 0) {
                console.log('âŒ GPS ìœ„ì¹˜ ì •ë³´ ë˜ëŠ” ì§€ì—­ ë°ì´í„° ì—†ìŒ');
                return;
            }
            
            console.log('ğŸ” ìµœê·¼ì ‘ ì§€ì—­ ì°¾ê¸° ì‹œì‘...');
            console.log(`ğŸ“ í˜„ì¬ GPS ì¢Œí‘œ: ${currentLocation.latitude}, ${currentLocation.longitude}`);
            
            // í•œêµ­ 17ê°œ ì‹œë„ë³„ ë” ì •í™•í•œ ì¤‘ì‹¬ ì¢Œí‘œ
            const regionCoordinates = {
                'seoul': { lat: 37.5665, lng: 126.9780, name: 'ì„œìš¸íŠ¹ë³„ì‹œ' },
                'busan': { lat: 35.1796, lng: 129.0756, name: 'ë¶€ì‚°ê´‘ì—­ì‹œ' },
                'daegu': { lat: 35.8714, lng: 128.6014, name: 'ëŒ€êµ¬ê´‘ì—­ì‹œ' },
                'incheon': { lat: 37.4563, lng: 126.7052, name: 'ì¸ì²œê´‘ì—­ì‹œ' },
                'gwangju': { lat: 35.1595, lng: 126.8526, name: 'ê´‘ì£¼ê´‘ì—­ì‹œ' },
                'daejeon': { lat: 36.3504, lng: 127.3845, name: 'ëŒ€ì „ê´‘ì—­ì‹œ' },
                'ulsan': { lat: 35.5384, lng: 129.3114, name: 'ìš¸ì‚°ê´‘ì—­ì‹œ' },
                'sejong': { lat: 36.4800, lng: 127.2890, name: 'ì„¸ì¢…íŠ¹ë³„ìì¹˜ì‹œ' },
                'gyeonggi': { lat: 37.4138, lng: 127.5183, name: 'ê²½ê¸°ë„' },
                'gangwon': { lat: 37.8228, lng: 128.1555, name: 'ê°•ì›íŠ¹ë³„ìì¹˜ë„' },
                'chungbuk': { lat: 36.8, lng: 127.7, name: 'ì¶©ì²­ë¶ë„' },
                'chungnam': { lat: 36.5, lng: 126.8, name: 'ì¶©ì²­ë‚¨ë„' },
                'jeonbuk': { lat: 35.7175, lng: 127.1530, name: 'ì „ë¶íŠ¹ë³„ìì¹˜ë„' },
                'jeonnam': { lat: 34.8679, lng: 126.991, name: 'ì „ë¼ë‚¨ë„' },
                'gyeongbuk': { lat: 36.4919, lng: 128.8889, name: 'ê²½ìƒë¶ë„' },
                'gyeongnam': { lat: 35.4606, lng: 128.2132, name: 'ê²½ìƒë‚¨ë„' },
                'jeju': { lat: 33.4996, lng: 126.5312, name: 'ì œì£¼íŠ¹ë³„ìì¹˜ë„' }
            };
            
            let nearestRegion = null;
            let shortestDistance = Infinity;
            let distanceDetails = [];
            
            // ëª¨ë“  ì§€ì—­ê³¼ì˜ ê±°ë¦¬ ê³„ì‚°
            regionsData.forEach(region => {
                const coords = regionCoordinates[region.code];
                if (coords) {
                    const distance = calculateDistance(
                        currentLocation.latitude,
                        currentLocation.longitude,
                        coords.lat,
                        coords.lng
                    );
                    
                    distanceDetails.push({
                        code: region.code,
                        name: region.name,
                        distance: distance.toFixed(1)
                    });
                    
                    if (distance < shortestDistance) {
                        shortestDistance = distance;
                        nearestRegion = region;
                    }
                }
            });
            
            // ê±°ë¦¬ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ë¡œê·¸ ì¶œë ¥
            distanceDetails.sort((a, b) => parseFloat(a.distance) - parseFloat(b.distance));
            console.log('ğŸ“Š ëª¨ë“  ì§€ì—­ê³¼ì˜ ê±°ë¦¬:');
            distanceDetails.slice(0, 5).forEach((detail, index) => {
                console.log(`${index + 1}. ${detail.name}: ${detail.distance}km ${index === 0 ? 'â­ï¸ ì„ íƒë¨' : ''}`);
            });
            
            if (nearestRegion) {
                console.log(`ğŸ¯ ìµœì¢… ì„ íƒ ì§€ì—­: ${nearestRegion.name} (${shortestDistance.toFixed(1)}km)`);
                
                // í˜„ì¬ ìœ„ì¹˜ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
                const currentLocationText = document.getElementById('currentLocationText');
                if (currentLocationText) {
                    currentLocationText.innerHTML = `
                        <span class="text-green-700 font-medium">
                            ğŸ“ ${nearestRegion.name} (${shortestDistance.toFixed(1)}km ì´ë‚´)
                        </span>
                    `;
                }
                
                // ìë™ìœ¼ë¡œ ê°€ì¥ ê°€ê¹Œìš´ ì§€ì—­ ì„ íƒ
                selectRegion(nearestRegion.code);
                
                // ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼
                setTimeout(() => {
                    const alertMsg = `GPS ê¸°ë°˜ìœ¼ë¡œ "${nearestRegion.name}"ì´ ìë™ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ì§€ì—­ì„ ë³´ë ¤ë©´ ì§€ì—­ ì„ íƒê¸°ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”.`;
                    if (confirm(alertMsg + '\n\nì´ ë©”ì‹œì§€ë¥¼ ë‹¤ì‹œ ë³´ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                        // ì‚¬ìš©ìê°€ 'í™•ì¸'ì„ ì„ íƒí•˜ë©´ ì•„ë¬´ê²ƒë„ í•˜ì§€ ì•ŠìŒ
                    }
                }, 1500);
                
            } else {
                console.log('âŒ ê°€ì¥ ê°€ê¹Œìš´ ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                
                // ì˜¤ë¥˜ ìƒíƒœ í‘œì‹œ
                const currentLocationText = document.getElementById('currentLocationText');
                if (currentLocationText) {
                    currentLocationText.innerHTML = `
                        <span class="text-red-600 font-medium">
                            âš ï¸ ì§€ì—­ì„ ì°¾ì„ ìˆ˜ ì—†ìŒ (ìˆ˜ë™ ì„ íƒ í•„ìš”)
                        </span>
                    `;
                }
            }
        }

        // Calculate Distance between two points (Haversine formula)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // ì§€êµ¬ ë°˜ì§€ë¦„ (km)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Get Time Ago String
        function getTimeAgo(date) {
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            
            if (seconds < 60) return 'ë°©ê¸ˆ';
            if (seconds < 3600) return `${Math.floor(seconds / 60)}ë¶„ ì „`;
            if (seconds < 86400) return `${Math.floor(seconds / 3600)}ì‹œê°„ ì „`;
            return `${Math.floor(seconds / 86400)}ì¼ ì „`;
        }

        // Update Gas Station Section Title
        function updateGasStationTitle() {
            const titleElement = document.getElementById('gasStationTitle');
            const subtitleElement = document.getElementById('gasStationSubtitle');
            
            if (!titleElement || !subtitleElement) return;
            
            if (currentLocation && selectedRegion) {
                const selectedRegionData = regionsData.find(r => r.code === selectedRegion);
                const regionName = selectedRegionData ? selectedRegionData.name : 'í˜„ì¬ ì§€ì—­';
                
                titleElement.textContent = `${regionName} ë‚´ ìµœì €ê°€ ì£¼ìœ ì†Œ`;
                subtitleElement.textContent = `GPS ê¸°ë°˜ í˜„ì¬ ì§€ì—­ë§Œ í‘œì‹œ Â· ìµœì €ê°€ ìˆœ ì •ë ¬ Â· ì‹¤ì œ ê±°ë¦¬`;
            } else {
                titleElement.textContent = 'ê°€ê²© ìš°ì„  ìµœì €ê°€ ì£¼ìœ ì†Œ';
                subtitleElement.textContent = 'ìµœì €ê°€ ìˆœ ì •ë ¬ Â· GPS ê±°ë¦¬ í‘œì‹œ Â· 15ê°œ ë³€ë™ìš”ì¸ ë¶„ì„';
            }
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>